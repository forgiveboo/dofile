(()=>{"use strict";var t={2171:(t,e,n)=>{n.d(e,{P:()=>a,L:()=>o});const s=(t,e,n)=>t.replace(e,n).split("\n"),r={chinese:new class{getWidth(t){return t.length}startsWithComma(t){return null!==t.match(/^[，、]/)}startsWithPeroid(t){return null!==t.match(/^[。？！：；”」》）】)\]]/)}startsWithSymbol(t){return this.startsWithComma(t)||this.startsWithPeroid(t)}endsWithComma(t){return null!==t.match(/[，、]$/)}endsWithPeriod(t){return null!==t.match(/[。？！：；”」》）】)\]♪]$/)}endsWithSymbol(t){return this.endsWithComma(t)||this.endsWithPeriod(t)}segment(t){return(t=>{if(""===t.trim())return[t];const e=/([，。？！：；、”」》）】)\]] *)/g,n=/([“「《【([])/g,r=[];for(const a of s(t,e,"$1\n"))r.push(...s(a,n,"\n$1"));return r.filter((t=>""!==t))})(t)}oneline(t){return(t=>{const e=t.split("\n").map((t=>t.trim())).filter((t=>""!==t));if(e.length<=1)return e.join("");const n=/\p{Unified_Ideograph}/u,s=/[，。？！：；、“”「」《》（）【】]/,r=[];for(let t=0;t<e.length-1;t++){const a=e[t],o=e[t+1],i=a[a.length-1],c=o[0];i.match(n)&&c.match(n)||i.match(s)||c.match(s)?r.push(a):r.push(a," ")}return r.push(e[e.length-1]),r.join("")})(t)}pretty(t){return(t=>(t=t.replace(/(\p{Unified_Ideograph})([\w%#])/gu,"$1 $2")).replace(/([\w%#])(\p{Unified_Ideograph})/gu,"$1 $2"))(t)}},english:new class{getWidth(t){return t.split(/\s/).length}startsWithComma(t){return null!==t.match(/^[,]/)}startsWithPeroid(t){return null!==t.match(/^[.?!:;"')\]”…]/)}startsWithSymbol(t){return this.startsWithComma(t)||this.startsWithPeroid(t)}endsWithComma(t){return null!==t.match(/[,]$/)}endsWithPeriod(t){return null!==t.match(/[.?!:;"')\]”…♪]$/)}endsWithSymbol(t){return this.endsWithComma(t)||this.endsWithPeriod(t)}segment(t){return[t]}oneline(t){return t.replace(/ ?\n/g," ")}pretty(t){return t}}},a=t=>(t=t.toLowerCase().replace("_","-").trim()).match(/^zh\b/)||t.match(/^ja\b/)?r.chinese:r.english,o=t=>{let e=t.match(/[\u3040-\u309f\u30a0-\u30ff]+/g);return e&&e.length>4?"ja":(e=t.match(/[\uac00-\ud7ff]+/g),e&&e.length>4?"ko":(e=t.match(/[\u4e00-\u9fa5]+/g),e&&e.length>4?"zh":"en"))}},5329:(t,e,n)=>{n.d(e,{lU:()=>s,Wr:()=>r,g9:()=>a});const s=t=>{const e=[];for(const n of t.events){const t=n.tStartMs??0,s=n.dDurationMs??0,r=n.segs??[];if(0===r.length)continue;const a=[];for(const e of r){const n=t+(e.tOffsetMs??0),s=0,r=e.utf8??"";a.push({start:n,duration:s,content:r})}let o=0;for(let t=0;t<a.length-1;t++){const e=a[t],n=a[t+1].start-e.start;e.duration=n,o+=n}a[a.length-1].duration=s-o,e.push(...a)}for(let t=0;t<e.length-1;t++){const n=e[t],s=e[t+1];n.start+n.duration>s.start&&(n.duration=s.start-n.start)}return e},r=t=>{const e=t[0].start;let n=0;const s=[];for(const e of t)n+=e.duration,s.push(e.content);return{start:e,duration:n,content:s.join("")}},a=t=>{let e=0;for(const n of t)e+=n.duration;return e}},7242:(t,e,n)=>{n.d(e,{KY:()=>s,XQ:()=>r,oY:()=>i});const s=t=>t.replaceAll("（","(").replaceAll("）",")").replace(/ *\(/g," (").trim(),r=t=>t.toLowerCase().replaceAll("_","-").trim(),a=[new URL(location.href).searchParams.get("hl")??navigator.language,"en"],o=new Intl.DisplayNames(a,{type:"language"}),i=t=>{t=r(t);const e=o.of(t)??t;return s(e)}},1031:(t,e,n)=>{n.d(e,{o:()=>a,c:()=>o});var s=n(2171);const r={chinese:new class{removeInlineSource(t){return t.replace(/(\p{Unified_Ideograph})（[A-Za-z ]+）/gu,"$1")}replaceFullWidth(t){return t.replace(/[\uff01-\uff5e]/g,(t=>t.match(/[，？！：；（）]/)?t:String.fromCharCode(t.charCodeAt(0)-65248)))}replacePunctuation(t){return t.replace(/\.\.\.+/g,"……")}replaceCustomText(t){return t.replace(/您/g,"你")}afterTranslate(t){return t=this.removeInlineSource(t),t=this.replaceFullWidth(t),t=this.replacePunctuation(t),this.replaceCustomText(t)}},english:new class{afterTranslate(t){return t}}},a=(t,e)=>{const n=(0,s.P)(e.languageCode),a=e.languageCode.toLowerCase().replace("_","-").trim().match(/^zh\b/)?r.chinese:r.english;return t.map((t=>(e.afterTranslate&&(t=a.afterTranslate(t)),t=t.split("\n").map((t=>t.trim())).filter((t=>""!==t)).join("\n"),t=n.oneline(t),n.pretty(t))))},o=(t,e)=>{const n=a(t.contents,e);t=t.clone();for(const[e,s]of t.dialogues.entries())s.content=n[e];return t}},8444:(t,e,n)=>{n.d(e,{iu:()=>o,QE:()=>i,kt:()=>Z,Wm:()=>a,jG:()=>I,Pp:()=>g,KA:()=>T,rS:()=>f,CD:()=>p,Hw:()=>m,nD:()=>d,HE:()=>N,TL:()=>M});const s=(t,e)=>[Math.floor(t/e),t%e],r=t=>{const e=t=>String(t).padStart(2,"0");let[n,r,a,o,i]=[0,0,0,0,0];return[i,o]=s(t,1e3),[r,a]=s(i,60),[n,r]=s(r,60),`${e(n)}:${e(r)}:${e(a)}.${c=o,String(c).padStart(3,"0")}`;var c},a=t=>{const e=t.split(":"),n=e.length,s=parseFloat(e[n-1]??"00.000"),r=60*parseInt(e[n-2]??"00"),a=1e3*(3600*parseInt(e[n-3]??"00")+r+s);return Math.floor(a)};class o{constructor(t,e,n){this.start=t,this.duration=e,this.content=n}clone(){return new o(this.start,this.duration,this.content)}get end(){return this.start+this.duration}get startString(){return r(this.start)}get endString(){return r(this.end)}between(t,e){return e=e??t,this.start<=t&&this.end>=e}}class i{constructor(t){this.dialogues=t}clone(){const t=this.dialogues.map((t=>t.clone()));return new i(t)}find(t,e){for(const n of this.dialogues)if(n.between(t,e))return n;return null}get contents(){return this.dialogues.map((t=>t.content))}get intervals(){const t=[];for(let e=0;e<this.dialogues.length-1;e++){const n=this.dialogues[e],s=this.dialogues[e+1];t.push(s.start-n.end)}return t.push(0),t}}const c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&lrm;":"‪","&rlm;":"‫"},l=t=>(t=>t.replace(/&.+?;/g,(t=>{const e=c[t];return void 0===e?t:e})))(t).replace(/<br\/>/g,"\n").replace(/<br .+?>/g,"\n").replace(/<.+?>/g,""),u=t=>t.replace(/{.+?}/g,"").replace(/\\[nN]/g,"\n").replace(/\\[hH]/g," "),h=(t,e,n)=>{const s=t.split(e);return s.length>n&&s.push(s.splice(n-1).join("")),s},d=t=>{if(!t.startsWith("WEBVTT"))throw"invalid text";const e=t.split("\n").map((t=>t.trim())),n=/([0-9:.]+) --> ([0-9:.]+)/,s=[];let r=null;for(const t of e)if(null===r){const e=t.match(n);e&&(r={matches:e,payloads:[]})}else if(""!==t)r.payloads.push(t);else{const t=a(r.matches[1]),e=a(r.matches[2])-t,n=l(r.payloads.join("\n"));s.push(new o(t,e,n)),r=null}return new i(s)},p=t=>{const e=t.split("\n").map((t=>t.trim())),n=/([0-9:,]+) --> ([0-9:,]+)/,s=[];let r=null;for(const t of e)if(null===r){const e=t.match(n);e&&(r={matches:e,payloads:[]})}else if(""!==t)r.payloads.push(t);else{const t=a(r.matches[1].replace(",",".")),e=a(r.matches[2].replace(",","."))-t,n=l(r.payloads.join("\n"));s.push(new o(t,e,n)),r=null}return new i(s)},g=t=>{if(!t.startsWith("[Script Info]"))throw"invalid text";if(!t.includes("ScriptType: v4.00"))throw"invalid text";const e=t.split("\n").map((t=>t.trim())),n=e.findIndex((t=>/^Format:.*Text$/.test(t))),s=e[n].split(",").map((t=>t.trim())),r=e.slice(n+1),c=s.length,l=s.findIndex((t=>"Start"===t)),d=s.findIndex((t=>"End"===t)),p=s.findIndex((t=>"Text"===t)),g=[];for(const t of r){if(""===t)continue;const e=h(t,",",c),n=a(e[l]),s=a(e[d])-n,r=u(e[p]),i=new o(n,s,r);g.push(i)}return new i(g)},f=t=>{const e=/\[([0-9:.]+)\](.*)/,n=t=>{const s=t.match(e);if(!s)return[];const r=a(s[1]);let o=s[2].trim();if(!o.match(e))return[{start:r,content:o}];const i=n(o);return o=i[0].content,[{start:r,content:o},...i]},s=t.split("\n").map((t=>t.trim())),r=[];for(const t of s)r.push(...n(t));if(r.sort(((t,e)=>t.start-e.start)),r.length>0){const t=r[r.length-1];if(""!==t.content){const e=500*t.content.length;r.push({start:t.start+e,content:""})}}const c=[];for(let t=0;t<r.length-1;t++){const e=r[t],n=e.start,s=r[t+1].start-n-1,a=e.content;""!==a&&c.push(new o(n,s,a))}return new i(c)},m=t=>{if(!t.includes('xml version="1.0" encoding='))throw"invalid text";if(!t.includes('="http://www.w3.org/ns/ttml"'))throw"invalid text";const e=(new globalThis.DOMParser).parseFromString(t,"application/xml").getElementsByTagName("body")[0].getElementsByTagName("p"),n=[];for(const t of e){const e=a(t.getAttribute("begin")),s=a(t.getAttribute("end"))-e,r=l(t.innerHTML);n.push(new o(e,s,r))}return new i(n)},y=t=>{const e=[];for(const n of t){if(0===e.length){e.push(n);continue}const t=e[e.length-1];t.end===n.start&&t.content===n.content?t.duration+=n.duration:e.push(n)}return e},v=(t,e,n)=>{const s=e.duration/(e.duration+n.duration),r=Math.floor(s*t.duration),a=t.duration-r;let o,i;return[o,i]=r>a?[r,a]:[a,r],e.duration>n.duration?[i,o]:[o,i]},w=(t,e)=>{const n=[];let s=0;for(;s<t.length;){const r=t[s];if(0===s||s===t.length-1){n.push(r),s+=1;continue}const a=n[n.length-1],o=t[s+1];if(a.end!==r.start||r.end!==o.start){n.push(r),s+=1;continue}if(!e(r,a,o)){n.push(r),s+=1;continue}const[i,c]=v(r,a,o);a.duration+=i,o.duration+=c,o.start-=c,n.push(o),s+=2}return n},b=(t,e,n)=>t.content===`${e.content}\n${n.content}`,S=t=>{const e=(t=>{const e=new Map;for(const n of t)for(const t of n.dialogues)e.set(t.start,!0),e.set(t.end,!0);const n=Array.from(e.keys());return n.sort(((t,e)=>t-e)),n})(t),n=[];for(let s=0;s<e.length-1;s++){const r=e[s],a=e[s+1],o=[];let i=!1;for(const e of t){const t=e.find(r,a);t?(i=!0,o.push(t.content)):o.push("")}i&&n.push({start:r,end:a,contents:o})}const s=[];for(const t of n){const e=t.start,n=t.end-t.start,r=t.contents.join("\n");s.push(new o(e,n,r))}return s},x=(t,e)=>!!(""!==t&&(t.startsWith("\n")&&e.endsWith(t)||t.endsWith("\n")&&e.startsWith(t))),k=t=>{let e=!1;for(let n=1;n<t.length;n++){const s=t[n],r=t[n-1];s.start===r.end&&s.content!==r.content&&x(s.content,r.content)&&(s.content=r.content,e=!0)}for(let n=0;n<t.length-1;n++){const s=t[n],r=t[n+1];s.end===r.start&&s.content!==r.content&&x(s.content,r.content)&&(s.content=r.content,e=!0)}return e},C=t=>{const e=Array.from(t);let n=!0,s=0;for(;n&&s<5;)n=k(e),s+=1;return e},j=(t,e=6e4)=>w(t,(t=>(e,n,s)=>!!((t,e,n,s)=>!(t>e||t>n||t>s))(e.duration,n.duration,s.duration,t)&&!!((t,e,n)=>{const s=t.split("\n");if(s.length<=1)return!1;const r=s.pop(),a=s.join("\n");return!(""===a||""===r||!(e.startsWith(a)&&n.endsWith(r)||e.endsWith(r)&&n.startsWith(a)))})(e.content,n.content,s.content))(e)),M=t=>{let e=t.clone().dialogues;return e=(t=>{const e=(t=>{const e=new Map;for(const n of t)e.set(n.start,!0),e.set(n.end,!0);const n=Array.from(e.keys());return n.sort(((t,e)=>t-e)),n})(t),n=[];for(let s=0;s<e.length-1;s++){const r=e[s],a=e[s+1],o=[];for(const e of t)e.between(r,a)&&o.push(e.content);o.length>0&&n.push({start:r,end:a,contents:o})}const s=[];for(const t of n){const e=t.start,n=t.end-t.start,r=t.contents.join("\n");s.push(new o(e,n,r))}return s})(e),e=y(e),e=w(e,b),new i(e)},I=t=>{if(0===t.length)return new i([]);let e=t[0];for(let n=1;n<t.length;n++){let s=S([e,t[n]]);s=C(s),s=y(s),s=j(s),e=new i(s)}return e},N=t=>{const e=JSON.parse(t).events,n=[];for(const t of e){const e=t.tStartMs,s=t.dDurationMs,r=(t.segs??[]).map((t=>t.utf8)).join("").trim();""!==r&&n.push(new o(e,s,r))}return new i(n)},Z=t=>{const e=[];for(const n of t.dialogues){const t=n.start,s=n.duration,r=[{utf8:n.content}];e.push({tStartMs:t,dDurationMs:s,segs:r})}const n={wireMagic:"pb3",events:e,pens:[{}],wpWinPositions:[{}],wsWinStyles:[{}]};return JSON.stringify(n,null,4)},T=t=>{const e=JSON.parse(t).body,n=[];for(const t of e){const e=Math.round(1e3*t.from),s=Math.round(1e3*t.to)-e,r=t.content;""!==r&&2===t.location&&n.push(new o(e,s,r))}return new i(n)}},6978:(t,e,n)=>{n.d(e,{Z:()=>s});const s={storage:{get:t=>new Promise(((e,n)=>{chrome.storage.local.get(t,(t=>{const s=chrome.runtime.lastError;s?n(s):e(t)}))})),set:t=>new Promise(((e,n)=>{chrome.storage.local.set(t,(()=>{const t=chrome.runtime.lastError;t?n(t):e()}))}))},runtime:{sendMessage:t=>new Promise(((e,n)=>{chrome.runtime.sendMessage(t,(t=>{const s=chrome.runtime.lastError;s?n(s):e(t)}))}))},tabs:{query:t=>new Promise((e=>{chrome.tabs.query(t,(t=>{e(t)}))})),sendMessage:(t,e)=>new Promise(((n,s)=>{chrome.tabs.sendMessage(t,e,(t=>{const e=chrome.runtime.lastError;e?s(e):n(t)}))}))}}},540:(t,e,n)=>{n.d(e,{_:()=>s,N:()=>r});const s=t=>new Promise((e=>setTimeout(e,t))),r=t=>"zh-tw"===(t=t.toLowerCase().replace("_","-").trim())||"zh-hk"===t||"zh-mo"===t||"zh-hant"===t?"zh-hant":t.match(/^zh\b/)?"zh-hans":"en"},9366:(t,e,n)=>{n.d(e,{o:()=>s});const s=t=>{const e=new URL(t).hostname;if("www.youtube.com"===e||"m.youtube.com"===e)return"youtube";if("www.netflix.com"===e)return"netflix";if("www.primevideo.com"===e)return"primevideo";if("www.disneyplus.com"===e)return"disneyplus";if("www.paramountplus.com"===e)return"paramountplus";if("www.amcplus.com"===e)return"amcplus";if("www.peacocktv.com"===e)return"peacocktv";if("www.hulu.com"===e)return"hulu";if("play.hbomax.com"===e)return"hbomax";if("www.viki.com"===e)return"viki";if("www.hotstar.com"===e)return"hotstar";if("www.coursera.org"===e)return"coursera";if("www.udemy.com"===e)return"udemy";if("www.ted.com"===e)return"ted";if("www.ardmediathek.de"===e)return"ard";if("www.zdf.de"===e)return"zdf";if("www.arte.tv"===e)return"arte";if("vimeo.com"===e)return"vimeo";if("viu.tv"===e)return"viutv";if("www.iq.com"===e)return"iqiyiint";if("wetv.vip"===e)return"wetv";if("www.bilibili.com"===e)return"bilibili";if("music.163.com"===e)return"music163";throw`invalid url: ${t}`}},9755:(t,e,n)=>{n.d(e,{Z:()=>o});class s{constructor(){this.deferreds=[]}acquire(){const t=this.deferreds[this.deferreds.length-1]?.promise??Promise.resolve();return this.deferreds.push((()=>{const t={};return t.promise=new Promise(((e,n)=>{t.resolve=e,t.reject=n})),t})()),t}release(){const t=this.deferreds.shift();return t&&t.resolve(),Promise.resolve()}async apply(t,e,n){let s;await this.acquire();try{s=await Reflect.apply(t,e,n??[])}finally{await this.release()}return s}wrap(t,e){return async(...n)=>await this.apply(t,e,n)}}const r=new Date;r.getTimezoneOffset(),r.toTimeString().slice(12,17);var a=n(8444);class o{constructor(t){this.setting=t,this.cache=new Map,this.lock=new s}updateSetting(t){this.setting=t}async parse(t,e){return(0,a.nD)(e)}async fetch(t,e){return await(await fetch(e)).text()}async createSubtitleUrls(t){return[t.url]}async createSubtitle(t){const e=await this.createSubtitleUrls(t),n=[];for(const s of e){const e=await this.fetch(t,s),r=await this.parse(t,e);n.push(...r.dialogues)}return new a.QE(n)}async loadAtomic(t){const e=t.url;let n=this.cache.get(e);return n||(n=await this.createSubtitle(t),this.cache.set(e,n)),n.clone()}async load(t){return await this.lock.apply(this.loadAtomic,this,[t])}}},4511:(t,e,n)=>{n.d(e,{Z:()=>r});var s=n(7242);class r{constructor(t,e){this.setting=t,this.props=e,this.inject()}updateSetting(t){this.setting=t}inject(){const t=this.getScript(),e=document.createElement("script");e.textContent=`(${t})();`,document.head.appendChild(e),e.remove()}onMessage=t=>{if(t.source!==window)return;const{name:e,args:n}=t.data;"manifest"===e&&this.onManifest(n)};async onManifest(t){const e=await this.createManifest(t);if(null!==e){for(const t of e.items)t.name=(0,s.KY)(t.name),t.code=(0,s.XQ)(t.code);for(const t of e.translations??[])t.name=(0,s.KY)(t.name);this.props.onChange(e)}}getScript(){throw"not implemented"}async createManifest(t){throw"not implemented"}}},2909:(t,e,n)=>{n.d(e,{Z:()=>Ot});const s=React;var r=n.n(s);const a=ReactDOM;var o=n.n(a);new class{getItem(t){return new URL(location.href).searchParams.get(t)}setItem(t,e){const n=new URL(location.href);n.searchParams.set(t,e),history.replaceState(null,"",n.toString())}removeItem(t){const e=new URL(location.href);e.searchParams.delete(t),history.replaceState(null,"",e.toString())}clear(){const t=new URL(location.href),e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);history.replaceState(null,"",t.toString())}key(t){const e=new URL(location.href);return Array.from(e.searchParams.keys())[t]??null}get length(){const t=new URL(location.href);return Array.from(t.searchParams.keys()).length}};let i=0;const c=(t,e)=>"appearance"===t||"text-stroke"===t||"user-select"===t?((t,e)=>{for(const n of["","-webkit-","-moz-"]){const s=`${n}${t}`;if(CSS.supports(s,e))return[s,e]}return[t,e]})(t,e):"fit-content"===e?((t,e)=>{for(const n of["","-webkit-","-moz-"]){const s=`${n}${e}`;if(CSS.supports(t,s))return[t,s]}return[t,e]})(t,e):[t,e];class l{constructor(t){this.style=t,this.entries=[];for(const[t,e]of Object.entries(this.style))this.entries.push(this.createEntry(t,e));this.classes={};for(const t of this.entries)""!==t.className&&(this.classes[t.styleKey]=t.className);this.text=this.entries.map((t=>t.styleText)).join("\n"),this.node=document.createElement("style"),this.node.textContent=this.text}createEntry(t,e){let n,s;"@global"===t?(n="",s=""):(i+=1,n=`jss-${i}-${t}`,s=`.${n}`);const r=[];this.createRuleItem(s,e,r);const a=[];for(const[t,e]of r)Object.keys(e).length>0&&a.push(this.createRuleText(t,e));return{styleKey:t,styleValue:e,styleText:a.join("\n"),className:n}}createRuleItem(t,e,n){const s=t,r={};n.push([s,r]);for(const[t,a]of Object.entries(e))if("object"!=typeof a||Array.isArray(a))r[t]=a;else{const e=t.replace(/&/g,s);this.createRuleItem(e,a,n)}}createRuleText(t,e){const n=[`${t} {`];for(let[t,s]of Object.entries(e))t=t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`)),Array.isArray(s)&&(s=s.join(", ")),[t,s]=c(t,String(s)),n.push(`    ${t}: ${s};`);return n.push("}"),n.join("\n")}attach(){return this.node.isConnected||document.head.appendChild(this.node),this}remove(){this.node.isConnected&&this.node.remove()}toString(){return this.text}}const u=CSS.supports("-moz-appearance","none"),h=CSS.supports("-webkit-appearance","-apple-pay-button"),d=(navigator.standalone,t=>new l(t)),p=(t,e)=>u||h?{textStroke:t,paintOrder:"stroke"}:{position:"relative",zIndex:0,"&:before":{position:"absolute",left:"0",right:"0",zIndex:-1,content:`attr(${e})`,textStroke:t}},{classes:g}=d({root:{"& .dialogue":{display:"flex",alignItems:"baseline",flexWrap:"wrap","& .readings":{display:"flex",flexDirection:"column",fontSize:"50%",lineHeight:"1.5",textAlign:"center"},"& .reading":{display:"none"},"& .text":{whiteSpace:"pre-wrap"},"& .contents":{display:"flex",justifyContent:"center",lineHeight:"1",textAlign:"center"},"& .content":{display:"flex",flexDirection:"column-reverse"},"& .dividers":{display:"none",backgroundColor:"#fff",height:"2px",margin:"2px"},"& .grammars":{display:"flex",justifyContent:"center",gap:"0.5em",fontSize:"50%",lineHeight:"1.5"},"& .grammar":{display:"none"}}}}).attach();class f extends r().PureComponent{renderContent=(t,e)=>{const n=[];for(const e of Object.keys(t))if("text"!==e){const s=`reading ${e}`,a=t[e],o=a;n.push(r().createElement("span",{className:s,key:e,"data-value":a,"data-text":o},o))}const s=t.text,a=s;return r().createElement("span",{className:"content",key:e},r().createElement("span",{className:"text","data-value":s,"data-text":a},a),r().createElement("span",{className:"readings"},n))};renderDivider=()=>r().createElement("div",null);renderGrammar=(t,e)=>{const n=`grammar ${t.type}`,s=t.text,a=t.translation??s;return r().createElement("div",{className:n,key:e,"data-value":s,"data-text":a},a)};renderChild=(t,e)=>{const n=["token",t.classes].join(" ").trim();return r().createElement("div",{className:n,key:e},r().createElement("div",{className:"contents"},t.contents.map(this.renderContent)),r().createElement("div",{className:"dividers"},this.renderDivider()),r().createElement("div",{className:"grammars"},t.grammars.map(this.renderGrammar)))};renderChildren=()=>this.props.schema.items.map(this.renderChild);render(){let t=this.props.className;t=[g.root,t].join(" ").trim();const e=this.props.lang;return r().createElement("div",{className:t,lang:e},r().createElement("div",{className:"dialogue"},this.renderChildren()))}}var m=n(8444),y=n(1031);const v=[["あ","ア","a"],["い","イ","i"],["う","ウ","u"],["え","エ","e"],["お","オ","o"],["か","カ","ka"],["き","キ","ki"],["く","ク","ku"],["け","ケ","ke"],["こ","コ","ko"],["さ","サ","sa"],["し","シ","shi"],["す","ス","su"],["せ","セ","se"],["そ","ソ","so"],["た","タ","ta"],["ち","チ","chi"],["つ","ツ","tsu"],["て","テ","te"],["と","ト","to"],["な","ナ","na"],["に","ニ","ni"],["ぬ","ヌ","nu"],["ね","ネ","ne"],["の","ノ","no"],["は","ハ","ha"],["ひ","ヒ","hi"],["ふ","フ","fu"],["へ","ヘ","he"],["ほ","ホ","ho"],["ま","マ","ma"],["み","ミ","mi"],["む","ム","mu"],["め","メ","me"],["も","モ","mo"],["や","ヤ","ya"],["ゆ","ユ","yu"],["よ","ヨ","yo"],["ら","ラ","ra"],["り","リ","ri"],["る","ル","ru"],["れ","レ","re"],["ろ","ロ","ro"],["わ","ワ","wa"],["を","ヲ","wo"],["ん","ン","n"]],w=[["が","ガ","ga"],["ぎ","ギ","gi"],["ぐ","グ","gu"],["げ","ゲ","ge"],["ご","ゴ","go"],["ざ","ザ","za"],["じ","ジ","ji"],["ず","ズ","zu"],["ぜ","ゼ","ze"],["ぞ","ゾ","zo"],["だ","ダ","da"],["ぢ","ヂ","ji"],["づ","ヅ","zu"],["で","デ","de"],["ど","ド","do"],["ば","バ","ba"],["び","ビ","bi"],["ぶ","ブ","bu"],["べ","ベ","be"],["ぼ","ボ","bo"],["ぱ","パ","pa"],["ぴ","ピ","pi"],["ぷ","プ","pu"],["ぺ","ペ","pe"],["ぽ","ポ","po"]],b=[["きゃ","キャ","kya"],["きゅ","キュ","kyu"],["きょ","キョ","kyo"],["しゃ","シャ","sha"],["しゅ","シュ","shu"],["しょ","ショ","sho"],["ちゃ","チャ","cha"],["ちゅ","チュ","chu"],["ちょ","チョ","cho"],["にゃ","ニャ","nya"],["にゅ","ニュ","nyu"],["にょ","ニョ","nyo"],["ひゃ","ヒャ","hya"],["ひゅ","ヒュ","hyu"],["ひょ","ヒョ","hyo"],["みゃ","ミャ","mya"],["みゅ","ミュ","myu"],["みょ","ミョ","myo"],["りゃ","リャ","rya"],["りゅ","リュ","ryu"],["りょ","リョ","ryo"],["ぎゃ","ギャ","gya"],["ぎゅ","ギュ","gyu"],["ぎょ","ギョ","gyo"],["じゃ","ジャ","ja"],["じゅ","ジュ","ju"],["じょ","ジョ","jo"],["びゃ","ビャ","bya"],["びゅ","ビュ","byu"],["びょ","ビョ","byo"],["ぴゃ","ピャ","pya"],["ぴゅ","ピュ","pyu"],["ぴょ","ピョ","pyo"]],S=[["つぁ","ツァ","tsa"],["ふぁ","ファ","fa"],["うぃ","ウィ","wi"],["てぃ","ティ","ti"],["ふぃ","フィ","fi"],["でぃ","ディ","di"],["とぅ","トゥ","tu"],["どぅ","ドゥ","du"],["でゅ","デュ","dyu"],["うぇ","ウェ","we"],["しぇ","シェ","she"],["ちぇ","チェ","che"],["つぇ","ツェ","tse"],["ふぇ","フェ","fe"],["じぇ","ジェ","je"],["うぉ","ウォ","wo"],["つぉ","ツォ","tso"],["ふぉ","フォ","fo"]],x=[["ぁ","ァ","a"],["ぃ","ィ","i"],["ぅ","ゥ","u"],["ぇ","ェ","e"],["ぉ","ォ","o"],["ゃ","ャ","ya"],["ゅ","ュ","yu"],["ょ","ョ","yo"],["っ","ッ",'"']],k=["ｱ","ｲ","ｳ","ｴ","ｵ","ｶ","ｷ","ｸ","ｹ","ｺ","ｻ","ｼ","ｽ","ｾ","ｿ","ﾀ","ﾁ","ﾂ","ﾃ","ﾄ","ﾅ","ﾆ","ﾇ","ﾈ","ﾉ","ﾊ","ﾋ","ﾌ","ﾍ","ﾎ","ﾏ","ﾐ","ﾑ","ﾒ","ﾓ","ﾔ","ﾕ","ﾖ","ﾗ","ﾘ","ﾙ","ﾚ","ﾛ","ﾜ","ｦ","ﾝ","ｧ","ｨ","ｩ","ｪ","ｫ","ｬ","ｭ","ｮ","ｯ","ｶﾞ","ｷﾞ","ｸﾞ","ｹﾞ","ｺﾞ","ｻﾞ","ｼﾞ","ｽﾞ","ｾﾞ","ｿﾞ","ﾀﾞ","ﾁﾞ","ﾂﾞ","ﾃﾞ","ﾄﾞ","ﾊﾞ","ﾋﾞ","ﾌﾞ","ﾍﾞ","ﾎﾞ","ﾊﾟ","ﾋﾟ","ﾌﾟ","ﾍﾟ","ﾎﾟ"],C=(t,e)=>{const n=v.slice(0,5),s=[...v,...x,...w,...b,...S],r={};for(const a of s){const s=a[t],o=a[e];r[s]=o;for(const t of n)a[2].endsWith(t[2])&&(r[s+"ー"]=o+t[e])}return r},j=C(1,0),M=C(1,2),I=(()=>{const t=[...v,...x,...w],e={"｡":"。","｢":"「","｣":"」","､":"、","･":"・",ｰ:"ー"};for(const[n,s]of t.entries())e[k[n]]=s[1];return e})(),N=(()=>{const t={};for(const[e,n]of v.slice(5,30).entries()){const s=w[e],r=n[0]+"ﾞ",a=n[1]+"ﾞ";t[r]=s[0],t[a]=s[1]}for(const[e,n]of v.slice(25,30).entries()){const s=w[e+20],r=n[0]+"ﾟ",a=n[1]+"ﾟ";t[r]=s[0],t[a]=s[1]}return t})(),Z=(()=>{const t=[...v,...w],e={};for(const n of t)e[n[1]]=n[2];return delete e["ン"],e})(),T=(()=>{const t={...Z};for(const e of x)t[e[1]]=e[2];return t})(),$=((()=>{const t=[...v,...w],e={};for(const[n,s,r]of t){if("n"===r)continue;const t=r[r.length-1];e[n]=t,e[s]=t}})(),(()=>{const t=[...v,...w],e={};for(const[n,s,r]of t){if("n"===r)continue;if("chi"===r){e[n]="t",e[s]="t";continue}const t=1===r.length?"":r[0];e[n]=t,e[s]=t}})(),(()=>{const t=[...v,...w],e={};for(const[n,s,r]of t){if("n"===r)continue;let t;"chi"===r?(t="t",t="t"):t=1===r.length?"":r[0],e[t+r[r.length-1]]=[n,s,r]}})(),t=>/^[\u3040-\u309f\u30a0-\u30ff]+$/.test(t)),O=t=>{let e=0;return t.replace(/[\u3040-\u309f\u30a0-\u30ff]/g,((n,s)=>{if(e>0)return e-=1,"";const r=t[s+1],a=t[s+2];let o=j[n+r+a];return o?(e=2,o):(o=j[n+r],o?(e=1,o):j[n]||n)}))},L=(t,e)=>{if("n"!==t.slice(-1))return e;const n=["a","i","u","e","o","ya","yu","yo"];for(const t of n)if(e.startsWith(t))return"'"+e;return e},E=(t,e)=>'"'!==t?e:e.startsWith("ch")?"t"+e:e.slice(0,1)+e,W=t=>{let e=0,n=0,s="";return t.replace(/[\u3040-\u309f\u30a0-\u30ff]/g,((r,a)=>{if(e>0)return e-=1,"";const o=n+1===a,i=t[a+1]||"",c=t[a+2]||"";let l=M[r+i+c];return l?(o&&(l=L(s,l),l=E(s,l)),e=2,n=a+2,s=l,l):(l=M[r+i],l?(o&&(l=L(s,l),l=E(s,l)),e=1,n=a+1,s=l,l):(l=M[r],l?(o&&(l=L(s,l),l=E(s,l)),e=0,n=a,'"'===l?(s='"',""):(s=l,l)):(e=0,n=0,s="",r)))}))},P=(t,e,n)=>{if($(e))return[[t],[e]];if(!/[\u3040-\u309f\u30a0-\u30ff]/.test(e)){const s=((t,e)=>{const n=[],s=[],r=()=>{s.length>0&&n.push(s.splice(0,s.length).join(""))};for(let n=0;n<t.length;n++){const a=t[n];if(!e&&"ッ"===a){r(),s.push(a);continue}const o=Z[a];if(o){if(s.length>0){const t=s[s.length-1];if("ッ"===t){s.push(a);continue}const e=(T[t]||"")+o;if(e.endsWith("ai")||e.endsWith("ei")||e.endsWith("ou")||e.endsWith("oo")||e.endsWith("uu")){s.push(a);continue}}r(),s.push(a)}else s.push(a)}return r(),n})(t,n);return s.length!==e.length?[[t],[e]]:[s,e.split("")]}let s,r;if($(e[0])){for(s=0;s<e.length&&$(e[s]);)s+=1;r=s}else if($(e[e.length-1])){for(s=e.length-1;s>=0&&$(e[s]);)s-=1;s=s+1-e.length,r=s}else{for(s=0;s<e.length&&!$(e[s]);)s+=1;const n=O(e[s]),a=O(t);for(r=0;r<t.length&&a[r]!==n;)r+=1}const a=t.slice(0,r),o=e.slice(0,s),i=t.slice(r),c=e.slice(s),[l,u]=P(a,o,n),[h,d]=P(i,c,n);return[[...l,...h],[...u,...d]]},z=(()=>{const t={"!":"！","?":"？"},e=Object.keys(t).join(),n=new RegExp(`[${e}]`,"g"),s=e=>t[e]??e;return t=>t.replace(n,s)})(),D=(()=>{const t=/[\uff01-\uff5e]/g,e=t=>String.fromCharCode(t.charCodeAt(0)-65248);return n=>n.replace(t,e)})(),R=t=>(t=(t=>{let e=0;return t.replace(/[\u3040-\u309f\u30a0-\u30ff\uff61-\uff9f]/g,((n,s)=>{if(e>0)return e-=1,"";const r=t[s+1];if("ﾞ"===r||"ﾟ"===r){const t=n+r;let s=I[t];if(s)return e=1,s;if(s=N[t],s)return e=1,s}return e=0,I[n]||n}))})(t),t=D(t),(t=z(t)).replace(/[ \u3000]+/g," ").replace(/([，。！？])\s+/g,"$1"));var A=n(2171);const q=JSON.parse('{"zh-hans":{"BeiDongXingShi":"被动形式","Dai":"代","DongEr":"动二","DongSan":"动三","DongYi":"动一","FouDing":"否定","Fu":"副","FuCiHua":"副词化","GanTan":"感叹","GuoQu":"过去","JiBenXing":"基本形","JiaDing":"假定","JiaDingXing":"假定形","JianTi":"简体","JianYi":"建议","JieTou":"接头","JieWei":"接尾","JieXu":"接续","JingTi":"敬体","KeNengXingShi":"可能形式","KenDing":"肯定","LianTi":"连体","MaSuXing":"ます形","Ming":"名","MingCiHua":"名词化","MingLing":"命令","MingLingXing":"命令形","NaIXing":"ない形","Shi":"事","ShiYiXingShi":"使役形式","Shu":"数","TaDong":"他动","TaXing":"た形","TeXing":"て形","Wai":"外","Wu":"无","XianZai":"现在","XingEr":"形二","XingYi":"形一","YiZhi":"意志","YiZhiXing":"意志形","Zhu":"助","ZhuDong":"助动","Zhuan":"专","ZiDong":"自动","ZiTaDong":"自他动"}}');class J{constructor(t,e=!0){this.tokens=t,this.compact=e}getSpeakingText(t){const{text:e,speaking:n}=t;return n?"は"===e&&t.particle?"ワ":"へ"===e&&t.particle?"エ":"を"===e&&t.particle?"オ":n.text:""}createContent(t,e,n){return this.compact&&($(t)||/^[\x20-\x7e、，。]+$/.test(t))?{loanword:n,text:t}:{hiragana:O(e),katakana:e,romaji:(s=W(e),s.replace(/aa/g,"ā").replace(/uu/g,"ū").replace(/oo/g,"ō").replace(/ou/g,"ō").replace(/ee/g,"ei")),loanword:n,text:t};var s}createContents(t){const{text:e,speaking:n,detail:s}=t;if(!n)return[{text:e}];const r=this.getSpeakingText(t);if(s&&s.loanword){const t=s.loanword;return[this.createContent(e,r,t)]}if($(e))return[this.createContent(e,r)];const[a,o]=P(n.text,e),i=[];for(let t=0;t<o.length;t++){const e=this.createContent(o[t],a[t]);i.push(e)}return i}createGrammarsByDetail(t){const e=t.detail;if(!e)return[];const n=[],s=e.type;if(s&&s.startsWith("verb")){let t;t=s.endsWith("+")?"自动":s.endsWith("-")?"他动":s.endsWith("*")?"自他动":"",""!==t&&n.push({type:"sense",text:t})}return e.jlpt&&n.push({type:"jlpt",text:e.jlpt}),n}doNoun(t){const e=t.noun;let n;n="专有名词"===e.type?"专":"形式名词"===e.type?"事":"名",t.detail&&t.detail.loanword&&(n="外");const s=[];return s.push({type:"pos",text:n}),s.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:s}}doVerb(t){let e,n=t.verb;n.root&&(n={type:n.root.type,base:n.root.base,form:n.root.kind,tags:[...n.tags]}),e="一类动词"===n.type?"动一":"二类动词"===n.type?"动二":"三类动词"===n.type?"动三":"动";const s=[];s.push({type:"pos",text:e}),s.push({type:"form",text:n.form});for(const t of n.tags)s.push({type:"tag",text:t});return s.push({type:"base",text:n.base}),s.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:s}}doAdjective(t){const e=t.adjective;let n;n="一类形容词"===e.type?"形一":"二类形容词"===e.type?"形二":"形";const s=[];s.push({type:"pos",text:n});for(const t of e.tags)s.push({type:"tag",text:t});return s.push({type:"base",text:e.base}),s.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:s}}doNumeral(t){const e=[];return e.push({type:"pos",text:"数"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doPronoun(t){const e=[];return e.push({type:"pos",text:"代"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doParticle(t){const e=[];return e.push({type:"pos",text:"助"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doAdverb(t){const e=[];return e.push({type:"pos",text:"副"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doConjunction(t){const e=[];return e.push({type:"pos",text:"连体"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doContinuation(t){const e=[];return e.push({type:"pos",text:"接续"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doPrefixion(t){const e=[];return e.push({type:"pos",text:"接头"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doSuffixion(t){const e=[];return e.push({type:"pos",text:"接尾"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doInterjection(t){const e=[];return e.push({type:"pos",text:"感叹"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doAuxiliary(t){const e=[];return e.push({type:"pos",text:"助动"}),e.push(...this.createGrammarsByDetail(t)),{classes:"",contents:this.createContents(t),grammars:e}}doPlain(t){const e=[];return e.push({type:"pos",text:"无"}),{classes:"",contents:this.createContents(t),grammars:e}}doConvert=t=>t.noun?this.doNoun(t):t.verb?this.doVerb(t):t.adjective?this.doAdjective(t):t.numeral?this.doNumeral(t):t.pronoun?this.doPronoun(t):t.particle?this.doParticle(t):t.adverb?this.doAdverb(t):t.conjunction?this.doConjunction(t):t.continuation?this.doContinuation(t):t.prefixion?this.doPrefixion(t):t.suffixion?this.doSuffixion(t):t.interjection?this.doInterjection(t):t.auxiliary?this.doAuxiliary(t):this.doPlain(t);getOutput(){return this.tokens.map(this.doConvert)}}const U=new class{constructor(){this.items={};for(const[t,e]of Object.entries(q["zh-hans"]))this.items[e]=t}get(t,e){const n=this.items[t];return n?e[n]??t:t}update(t,e){const n=["pos","form","tag","sense"];for(const s of t)for(const t of s.grammars)n.includes(t.type)&&(t.translation=this.get(t.text,e))}},X=t=>{let e=0;for(const n of t)e+=n.content.length+1;return e},G=(t,e)=>{let n=0;for(const[s,r]of t.entries())if(n+=r.content.length+1,n>=e)return s;return t.length-1},F=(t,e)=>{const n=t.slice(0,e+1),s=t.slice(e+1);if(0===n.length)throw"invalid index";return[n,s]},H=(t,e,n)=>{if(X(t)<n)return[Array.from(t),[]];const s=G(t,e),r=G(t,n);if(s===r)return F(t,s);const a=[];for(let e=s;e<r;e++){const n=e,s=t[e];let o=0;e<r&&(o=t[e+1].start-s.end);const i=s.end;a.push({index:n,interval:o,end:i})}return a.sort(((t,e)=>t.interval!==e.interval?e.interval-t.interval:e.end-t.end)),F(t,a[0].index)};class _{constructor(t,e,n){this.minSize=t,this.maxSize=e,this.preload=n,this.subtitles=[],this.offsets=[]}parse(t){this.subtitles=[];for(const e of((t,e,n)=>{if(0===n)return[Array.from(t)];const s=[];for(;t.length>0;){const[r,a]=H(t,e,n);s.push(r),t=a}return s})(t.dialogues,this.minSize,this.maxSize))this.subtitles.push(new m.QE(e));let e=0;this.offsets=[];for(let t=0;t<this.subtitles.length;t++)this.offsets.push(e),e+=X(this.subtitles[t].dialogues)}get duration(){const t=this.subtitles;if(0===t.length)return 0;const e=t[t.length-1].dialogues;return e[e.length-1].end}getIndex(t){for(const[e,n]of this.subtitles.entries()){const s=n.dialogues,r=s[0],a=s[s.length-1];if(r.start>t)return-1;if(a.end>t)return e}return-1}getIndexes(t){const e=[],n=this.getIndex(t);-1!==n&&e.push(n);const s=this.getIndex(t+this.preload);return-1!==s&&s>n&&e.push(n+1),e}}var B=n(6978),Y=n(540);const V=async(t,e)=>{let n,s,r=0;for(;;){try{n=await B.Z.runtime.sendMessage({name:t,args:e})}catch(t){s=t.message}if(void 0!==n)break;if(!(r<1e3))throw s??"invalid response message";r+=200,await(0,Y._)(200)}const{ok:a,data:o}=n;if(!a)throw o;return o},K=async t=>await V("translate",t),Q=async t=>await V("zhtools",t),tt=async t=>await V("jatools",t);var et=n(62);const nt=JSON.parse('{"en":{"BeiDongXingShi":"被動形式","Dai":"代","DongEr":"動二","DongSan":"動三","DongYi":"動一","FouDing":"否定","Fu":"副","FuCiHua":"副詞化","GanTan":"感嘆","GuoQu":"過去","JiBenXing":"基本形","JiaDing":"假定","JiaDingXing":"假定形","JianTi":"簡體","JianYi":"建議","JieTou":"接頭","JieWei":"接尾","JieXu":"接續","JingTi":"敬體","KeNengXingShi":"可能形式","KenDing":"肯定","LianTi":"連體","MaSuXing":"ます形","Ming":"名","MingCiHua":"名詞化","MingLing":"命令","MingLingXing":"命令形","NaIXing":"ない形","Shi":"事","ShiYiXingShi":"使役形式","Shu":"數","TaDong":"他動","TaXing":"た形","TeXing":"て形","Wai":"外","Wu":"無","XianZai":"現在","XingEr":"形二","XingYi":"形一","YiZhi":"意志","YiZhiXing":"意志形","Zhu":"助","ZhuDong":"助動","Zhuan":"專","ZiDong":"自動","ZiTaDong":"自他動"}}'),st=JSON.parse('{"zh-hant":{"BeiDongXingShi":"被動形式","Dai":"代","DongEr":"動二","DongSan":"動三","DongYi":"動一","FouDing":"否定","Fu":"副","FuCiHua":"副詞化","GanTan":"感嘆","GuoQu":"過去","JiBenXing":"基本形","JiaDing":"假定","JiaDingXing":"假定形","JianTi":"簡體","JianYi":"建議","JieTou":"接頭","JieWei":"接尾","JieXu":"接續","JingTi":"敬體","KeNengXingShi":"可能形式","KenDing":"肯定","LianTi":"連體","MaSuXing":"ます形","Ming":"名","MingCiHua":"名詞化","MingLing":"命令","MingLingXing":"命令形","NaIXing":"ない形","Shi":"事","ShiYiXingShi":"使役形式","Shu":"數","TaDong":"他動","TaXing":"た形","TeXing":"て形","Wai":"外","Wu":"無","XianZai":"現在","XingEr":"形二","XingYi":"形一","YiZhi":"意志","YiZhiXing":"意志形","Zhu":"助","ZhuDong":"助動","Zhuan":"專","ZiDong":"自動","ZiTaDong":"自他動"}}'),rt=JSON.parse('{"en":{"LANG_CODE":"en","LANG_NAME":"English","LANG_LOCAL":"English"},"zh-hans":{"LANG_CODE":"zh-hans","LANG_NAME":"Simplified Chinese","LANG_LOCAL":"简体中文"},"zh-hant":{"LANG_CODE":"zh-hant","LANG_NAME":"Traditional Chinese","LANG_LOCAL":"繁體中文"}}'),at=new class{constructor(t){this.dataset=(t=>{const e={};for(const n of t)for(const[t,s]of Object.entries(n))e[t]||(e[t]={}),Object.assign(e[t],s);return e})(t)}get(t){return t=function(t){return""===(t=t.toLowerCase().replace("_","-").trim())?"en":"zh-tw"===t||"zh-hk"===t||"zh-mo"===t||"zh-hant"===t?"zh-hant":t.match(/^zh\b/)?"zh-hans":t.split("-")[0]}(t),this.dataset[t]||(t="en"),this.dataset[t]}}([nt,q,st,rt]),ot=(it=et.Z.i18nCode,{term:at.get(it)});var it;const ct={type:"plain",data:"",language:"en"},lt={dialogues:[]},ut=t=>t.translated.data,ht=t=>{const e=t.start,n=t.end-t.start,s=ut(t);return new m.iu(e,n,s)},dt=t=>{const e=t.dialogues.map(ht);return new m.QE(e)},pt=(t,e,n,s)=>{if("plain"===e)return((t,e)=>{const n=((t,e)=>{const n=(0,A.P)(e).segment(t);return n.length>1?n:t.length<=48?[t]:(t=>{const e=[],n=[];let s=0,r=0;const a=t.split(" ");for(;a.length>0;)if(s<=r){const t=a.shift();e.push(t),s+=t.length}else{const t=a.pop();n.unshift(t),r+=t.length}return e.push(""),[e.join(" "),n.join(" ")]})(t)})(t,e);return n.map((t=>({classes:"",contents:[{text:t}],grammars:[]})))})(t,n);if("zhtools"===e)return(t=>t.map((t=>({classes:"",contents:[{text:t[0],pinyin:` ${t[1]} `}],grammars:[]}))))(t);if("jatools"===e){const{furiganaCharacter:e}=s.language.japanese;return((t,e,n)=>{const s=new J(t,e).getOutput();return U.update(s,n),s})(t,"kanji"===e,ot.term)}throw"invalid type"};class gt{constructor(t,e,n){this.setting=t,this.fetcher=e,this.intent=n,this.bioscope=new _(2900,3e3,3e4),this.mapping=new Map,this.initial()}async initial(){const t=await this.doCreate();this.bioscope.parse(t),this.touch(0)}async touch(t){const e=this.bioscope.getIndexes(t);for(const t of e)this.mapping.has(t)||(this.mapping.set(t,lt),this.cook(t))}async cook(t){await this.cookNormalized(t),await this.cookTranslated(t),await this.cookToolkited(t)}async cookNormalized(t){const e=this.intent.file.split(".")[0],n=this.bioscope.subtitles[t].dialogues,s=[];for(const t of n){const n=t.start,r=t.end,a=t.content,o={type:"plain",data:a,language:e};s.push({start:n,end:r,content:a,normalized:o,translated:o,toolkited:o,finalized:o})}const r={dialogues:s};this.mapping.set(t,r)}async cookTranslated(t){const e=this.intent;if(""===e.translate)return;const{translationEngine:n}=this.setting.language.translation,{translationMode:s}=this.setting.language.translation,{apiKey:r}=this.setting.network.server,a=e.file.split("."),o=a[0],i=a[1]??"",c=e.translate;if(((t,e)=>t.match(/^zh\b/)?("zh-cn"===t&&(t="zh-hans"),"zh-tw"!==t&&"zh-hk"!==t&&"zh-mo"!==t||(t="zh-hant"),t===e):t.split("-")[0]===e)(o,c))return;const l=o.split("-")[0],u=c,h=n,d=et.Z.website;let p=s;"auto"===p&&(p=((t,e,n)=>"auto"!==t?t:e.match(/^zh\b/)||"music163"===n?"normal":"enhance")(p,o,d));let g="";"youtube"===d&&"asr"===i&&(g="asr");const f=this.bioscope.offsets[t],m=this.mapping.get(t).dialogues,v=[];for(const t of m)v.push(t.normalized.data);let w=[];("youtube"===d&&"asr"===i||"music163"===d)&&(w=(t=>{const e=[];for(let n=0;n<t.length-1;n++){const s=t[n],r=t[n+1];e.push(r.start-s.end)}return e.push(0),e})(m));const b={contents:v,target:u,source:l,intervals:w,engine:h,mode:p,trait:g,offset:f,website:d,apiKey:r};let S;try{const t=await K(b);S=(0,y.o)(t,{languageCode:c,afterTranslate:!0})}catch(t){const e=`{ ${(t=>"TypeError: Failed to fetch"===t?"https://www.dualsub.xyz/error/failed-to-fetch":t)(t)} }`;S=v.map((()=>e))}for(const[t,e]of m.entries()){const n={type:"plain",data:S[t],language:c};e.translated=n,e.toolkited=n,e.finalized=n}}async cookToolkited(t){const e=((t,e)=>{if(""===t.legend)return"";const n=""===t.translate?t.file:t.translate;let s="";for(const n of e.style.themes)if(n.name===t.legend){s=n.toolkit??"";break}return"zhtools"===s&&n.match(/^zh\b/)||"jatools"===s&&n.match(/^ja\b/)?s:""})(this.intent,this.setting);if(""===e)return;const n=this.mapping.get(t).dialogues;let s=[];for(const t of n)s.push(t.translated.data);const r=et.Z.website;let a;if("zhtools"===e){const t=this.setting.language.chinese.pinyinScheme;a=await Q({contents:s,style:t,website:r})}else"jatools"===e?(s=s.map(R),a=await tt({contents:s,website:r})):a=s;for(const[t,s]of n.entries()){const n={type:e,data:a[t],language:s.translated.language};s.toolkited=n,s.finalized=n}}async doCreate(){const t=this.intent,e=this.fetcher;let n;return n=t.url.startsWith("custom://")?await(async t=>{const e=new URL(t.url).searchParams.get("text"),n=await(await fetch(e)).text(),s=[m.nD,m.CD,m.Pp,m.Hw,m.rS];for(const t of s){let e;try{e=t(n)}catch(t){continue}if(e.dialogues.length>0)return e}return new m.QE([])})(t):await e.load(t),n=(0,m.TL)(n),n=(0,y.c)(n,{languageCode:t.file}),n}getSubtitleIndex(t){const e=this.bioscope.subtitles;for(const[n,s]of e.entries()){const e=s.dialogues;if(e[e.length-1].end>t)return n}return e.length-1}getSubtitle(t){this.touch(t);const e=this.getSubtitleIndex(t);return this.mapping.get(e)??lt}updateSetting(t){this.setting=t}}class ft{constructor(t,e){this.setting=t,this.fetcher=e,this.workers=[]}updateSetting(t){this.setting=t,this.workers.forEach((e=>e.updateSetting(t)))}updateIntents(t){this.workers=[];for(const e of t){const t=new gt(this.setting,this.fetcher,e);this.workers.push(t)}}find(t){const e=((t,e)=>{t=t.map((t=>((t,e)=>{let n=0;for(const[s,r]of t.dialogues.entries())if(n=s,r.end>=e)break;const s=n-2<0?0:n-2,r=n+3;return{dialogues:t.dialogues.slice(s,r)}})(t,e)));const n=t.map(dt),s=(0,m.jG)(n).find(e);if(null===s)return[];const r=s.content.split("\n"),a=[];for(const[e,n]of r.entries()){const s=t[e].dialogues.find((t=>n===ut(t)))?.finalized??ct;a.push(s)}return a})(this.workers.map((e=>e.getSubtitle(t))),t),n=[];for(const t of e){const{data:e,language:s,type:r}=t,a=pt(e,r,s,this.setting);n.push({language:s,tokens:a})}return n}}const mt=t=>{const e=[];for(const n of t)e.includes(n)||e.push(n);return e},yt=["pinyin","hiragana","katakana","romaji","loanword","text"],vt=["pinyin","hiragana","katakana","romaji","loanword"],wt=["pos","form","tag","base","sense","jlpt"],bt=(t,e)=>void 0===e?t:`${t}${Math.round(e/100*255).toString(16).padStart(2,"0")}`,St=t=>{const e=[];for(const n of t){const t=n.name;""===t||e.includes(t)||e.push(t)}return e.map((t=>({label:t,value:t})))},xt=(t,e)=>{for(const n of e)if(t.includes(n))return!0;return!1},kt=t=>{const e=t.contents??[],n=t.grammars??[],s={};for(const t of yt)s[t]=e.map((e=>e[t])).join("");for(const t of wt)s[t]=n.filter((e=>e.type===t)).map((t=>t.text));return s},Ct=(t,e)=>{for(const n of Object.keys(e))if(yt.includes(n)){const s=new RegExp(e[n]),r=t[n];if(!s.test(r))return!1}else if(wt.includes(n)){const s=e[n],r=t[n];if(!xt(s,r))return!1}return!0};class jt{constructor(t){this.genreItems=t,this.mapping={},this.classNames={},this.sheetItems={};for(const[e,n]of t.entries()){const t=n.name;if(""===t||this.mapping[t])continue;const s=`genre-${e}`,r=this.createSheetItem(n,s);this.mapping[t]=n,this.classNames[t]=s,this.sheetItems[t]=r}}exists(t){return t.filter((t=>this.mapping[t]))}getClassName(t){return this.classNames[t]}getClassNames(t){return t.map((t=>this.classNames[t]))}getSheetItems(t){const e={};for(const n of this.genreItems){const s=n.name;t.includes(s)&&Object.assign(e,this.sheetItems[s])}return e}createSheetItem(t,e){const n=t.component;if(!n)return{};const s={};for(const t of Object.keys(n)){const r=n[t];null!==r&&(s[this.createSheetKey(t,r,e)]=this.createSheetValue(t,r))}return s}createSheetKey(t,e,n){let s;s="dialogue"===t?"& .dialogue":`& .token.${n} .${t}`;let r=e.match;if(void 0===r||""===r)return s;if("string"==typeof r&&(r=[r]),0===r.length)return s;const a=[];for(const t of r)a.push(s+`[data-value="${t}"]`);return a.join(", ")}createSheetValue(t,e){const n={},s=e.display;"true"===s?((vt.includes(t)||wt.includes(t))&&(n.display="revert"),"dividers"===t&&(n.display="block")):"false"===s?n.display="none":"preserve"===s&&("readings"!==t&&"grammars"!==t||(n.minHeight="1.5em"),"dividers"===t&&(n.display="block",n.visibility="hidden"));const r=e.fontSize;void 0!==r&&(n.fontSize=`${r}%`);const a=e.fontColor,o=e.fontOpacity;void 0!==a&&(n.color=bt(a,o));const i=e.fontBold;!0===i?n.fontWeight="bold":!1===i&&(n.fontWeight="normal");const c=e.fontItalic;!0===c?n.fontStyle="italic":!1===c&&(n.fontStyle="normal");const l=e.backgroundColor,u=e.backgroundOpacity;void 0!==l&&(n.backgroundColor=bt(l,u));const h=e.borderSize;if(void 0!==h){const t=e.borderColor??"#000000";n.border=`${t} solid ${h}px`}const d=e.fontEdgeEffect;if("none"===d)n.textShadow="none";else if("shadow"===d){const t=e.fontEdgeColor??"#222222",s=e.fontEdgeSize??2;n.textShadow=[`${t} ${s}px ${s}px ${s+1}px`,`${t} ${s}px ${s}px ${s+2}px`,`${t} ${s}px ${s}px ${s+3}px`]}const p=e.backgroundEdgeEffect;if("none"===p)n.boxShadow="none";else if("shadow"===p){const t=e.backgroundEdgeColor??"#000000";n.boxShadow=`0 0 2px 0 ${t}`}const g=e.flexAlign;return"center"===g?n.justifyContent="center":"left"===g?n.justifyContent="flex-start":"right"===g?n.justifyContent="flex-end":"evenly"===g&&(n.justifyContent="space-evenly"),n}}class Mt{constructor(t,e){this.rulerItems=t,this.genres=e,this.mapping={},this.genreNames={},this.conditions={};for(const n of t){const t=n.name;""===t||this.mapping[t]||(this.mapping[t]=n,this.genreNames[t]=e.exists(n.genres??[]),this.conditions[t]=n.tokens??{})}}exists(t){return t.filter((t=>this.mapping[t]))}getGenreNames(t){return this.genreNames[t]}getConditions(t){return this.conditions[t]}}class It{constructor(t,e,n){this.themeItems=t,this.genres=e,this.rulers=n,this.mapping={},this.basicGenreNames={},this.wholeGenreNames={},this.rulerNames={};for(const s of t){const t=s.name;if(""===t||this.mapping[t])continue;const r=e.exists(s.genres??[]),a=n.exists(s.rulers??[]),o=[...r];for(const t of a)o.push(...n.getGenreNames(t));this.mapping[t]=s,this.basicGenreNames[t]=r,this.wholeGenreNames[t]=mt(o),this.rulerNames[t]=s.rulers??[]}}exists(t){return t.filter((t=>this.mapping[t]))}getBasicGenreNames(t){return this.basicGenreNames[t]}getWholeGenreNames(t){return this.wholeGenreNames[t]}getRulerNames(t){return this.rulerNames[t]}}const Nt={genres:[],rulers:[],themes:[]};class Zt{constructor(t,e){e=e??Nt,this.id=t,this.config=e,this.genres=new jt(e.genres),this.rulers=new Mt(e.rulers,this.genres),this.themes=new It(e.themes,this.genres,this.rulers),this.appliedType="",this.appliedName="",this.sheetObject=null}get sheetString(){return this.sheetObject?this.sheetObject.toString():""}reset(){this.sheetObject&&this.sheetObject.remove(),this.appliedType="",this.appliedName="",this.sheetObject=null}update(t){this.config=t,this.genres=new jt(t.genres),this.rulers=new Mt(t.rulers,this.genres),this.themes=new It(t.themes,this.genres,this.rulers),this.sheetObject&&this.apply(`${this.appliedType}:${this.appliedName}`)}createSheetObject(t){const e=this.genres.getSheetItems(t),n=`.${this.id}`;return d({"@global":{[n]:e}})}apply(t){this.reset();const e=t.match(/^(.+?):(.*)$/);if(null===e)return;const n=e[1],s=e[2];if(""===n||""===s)return;let r;"genre"===n?r=this.genres.exists([s]):"ruler"===n?r=this.rulers.getGenreNames(s):"theme"===n&&(r=this.themes.getWholeGenreNames(s)),void 0!==r&&0!==r.length&&(this.appliedType=n,this.appliedName=s,this.sheetObject=this.createSheetObject(r),this.sheetObject.attach())}previewSheetString(t){return this.createSheetObject(t).toString()}connectGenreName(t,e){const n=this.genres.getClassName(t),s=[];for(const t of e)s.push({...t,classes:n});return s}connectRulerName(t,e){const n=this.rulers.getGenreNames(t),s=this.rulers.getConditions(t),r=this.genres.getClassNames(n).join(" "),a=[];for(const t of e){const e=kt(t);Ct(e,s)?a.push({...t,classes:r}):a.push({...t})}return a}connectThemeName(t,e){const n=this.themes.getBasicGenreNames(t),s=this.themes.getRulerNames(t),r=[];for(const t of e){let e=[...n];const a=kt(t);for(const t of s){const n=this.rulers.getConditions(t);Ct(a,n)&&e.push(...this.rulers.getGenreNames(t))}e=mt(e);const o=this.genres.getClassNames(e).join(" ");r.push({...t,classes:o})}return r}connect(t){const e=this.appliedType,n=this.appliedName;return"genre"===e?this.connectGenreName(n,t):"ruler"===e?this.connectRulerName(n,t):"theme"===e?this.connectThemeName(n,t):[...t]}getSchemaItems(){return{genres:St(this.config.genres),rulers:St(this.config.rulers),themes:St(this.config.themes)}}}class Tt{constructor(t){this.setting=t,this.legends=[],this.updateCount(2)}updateCount(t){const e=this.setting.style;for(let n=this.legends.length;n<t;n++){const t=new Zt(`dualsub-theme-${n+1}`,e);this.legends.push(t)}}updateIntents(t){this.updateCount(t.length);for(const[e,n]of t.entries())this.legends[e].apply(`theme:${n.legend}`)}updateSetting(t){this.setting=t,this.legends.forEach((e=>e.update(t.style)))}get(t){return this.legends[t]}}const{classes:$t}=d({root:{position:"absolute",bottom:"100px",left:"0",right:"0",margin:"auto",padding:"8px 16px",zIndex:99,width:"fit-content",fontSize:"calc(100vw / 1920 * 18 + 18px)","& .subtitles":{display:"flex",flexDirection:"column",gap:"4px",padding:"8px 16px"},"& .dialogue":{color:"#fff",justifyContent:"center","& .readings":{userSelect:"none","&:hover":{userSelect:"revert"}}}},stroke:{"& .subtitles":{"& [data-text]":p("4px #000000","data-text")}},background:{"& .subtitles":{background:"rgba(8, 8, 8, 0.75)"}},classic:{"& .subtitles":{gap:"6px",fontWeight:"bold",textShadow:["#222222 2px 2px 4px","#222222 2px 2px 5px","#222222 2px 2px 6px"],"& [data-text]":p("6px #000000","data-text")}},passthrough:{pointerEvents:"none"},selecttext:{"& *":{cursor:"text !important",userSelect:"text !important"}}}).attach();class Ot{constructor(t,e){this.setting=t,this.props=e,this.overlay=this.overlayCreate(),this.overlayUpdateSetting(),this.styler=new Tt(t),this.composer=new ft(t,e.fetcher),this.stage=null}overlayCreate(){const t=document.createElement("div");return t.classList.add($t.root,"dualsub-renderer"),t.setAttribute("translate","no"),t}overlaySetStyle(t){this.overlay.classList.remove($t.stroke),this.overlay.classList.remove($t.background),this.overlay.classList.remove($t.classic),"stroke"!==t?"background"!==t?"classic"!==t||this.overlay.classList.add($t.classic):this.overlay.classList.add($t.background):this.overlay.classList.add($t.stroke)}overlaySetMouse(t){this.overlay.classList.remove($t.passthrough),this.overlay.classList.remove($t.selecttext),"none"===t&&this.overlay.classList.add($t.passthrough),"text"===t&&this.overlay.classList.add($t.selecttext)}overlaySetBottom(t){this.overlay.style.bottom=100!==t?`${t}px`:""}overlayUpdateSetting(){const t=this.setting.general.rendering.bottomMargin,e=this.setting.general.rendering.baseStyle,n=this.setting.general.rendering.mouseAction;this.overlaySetBottom(t),this.overlaySetStyle(e),this.overlaySetMouse(n)}onTimeUpdate=()=>{const t=this.getPlayerTime(),e=this.composer.find(t);if(0===e.length)return void o().unmountComponentAtNode(this.overlay);const n=[];for(const[t,s]of e.entries()){const e=this.styler.get(t),a={items:e.connect(s.tokens)},o=`subtitle subtitle-${t+1} ${e.id}`;n.push(r().createElement(f,{key:t,className:o,schema:a}))}const s=r().createElement("div",{className:"subtitles"},n);o().render(s,this.overlay)};getPlayerTime(){return 1e3*this.stage.player.currentTime}startStage(t){this.stage||(t.curtain.appendChild(this.overlay),t.player.addEventListener("timeupdate",this.onTimeUpdate),this.stage=t)}stopStage(){this.stage&&(this.overlay.remove(),this.stage.player.removeEventListener("timeupdate",this.onTimeUpdate),this.stage=null)}updateStage(t){this.stopStage(),null!==t&&this.startStage(t)}updateIntents(t){this.styler.updateIntents(t),this.composer.updateIntents(t)}updateSetting(t){this.setting=t,this.overlayUpdateSetting(),this.styler.updateSetting(t),this.composer.updateSetting(t)}}},556:(t,e,n)=>{n.d(e,{Z:()=>s});class s{constructor(t,e){this.setting=t,this.props=e,this.stage=null,setInterval(this.watch,3e3)}updateSetting(t){this.setting=t}watch=()=>{const t=this.getStage(),e=this.checkChange(t,this.stage);this.stage=t,e&&this.props.onChange(t)};getStage(){const t=this.getHint();if(null===t)return null;const e=this.getMovieId();if(null===e)return null;const n=this.getCurtain();if(null===n)return null;const s=this.getPlayer();return null===s?null:{hint:t,movieId:e,curtain:n,player:s}}getHint(){return location.pathname}getMovieId(){return""}getCurtain(){return document.body}getPlayer(){return document.querySelector("video[src]")}checkChange(t,e){return(null!==t||null!==e)&&(null===t&&null!==e||null!==t&&null===e||(e=e,(t=t).hint!==e.hint||t.movieId!==e.movieId||t.curtain!==e.curtain||t.player!==e.player))}}},62:(t,e,n)=>{n.d(e,{Z:()=>o});var s=n(540),r=n(9366);const a=new URL(location.href).searchParams.get("hl"),o={i18nCode:(0,s.N)(a??navigator.language),website:(0,r.o)(location.href)}},5997:(t,e,n)=>{n.d(e,{Z:()=>_});const s=(t,e)=>{const n=t.type;if("string"===n||"number"===n||"boolean"===n)return typeof e===n;if("null"===n)return null===e;if("array"===n)return Array.isArray(e);if("object"===n)return"object"==typeof e&&null!==e&&!Array.isArray(e);throw`invalid schema type: ${n}`},r=(t,e)=>{const n=t.type;if("string"===n||"number"===n||"boolean"===n){t=t,void 0!==e&&void 0!==t.enum&&(t.enum.includes(e)||(e=void 0));let r=!1;if(void 0!==e&&(r=s(t,e)),r||void 0!==(e=t.default)&&(r=s(t,e)),"string"===n)return r?e:"";if("number"===n)return r?e:0;if("boolean"===n)return!!r&&e}if("null"===n)return null;if("array"===n)return[];if("object"===n)return{};throw`invalid schema type: ${n}`},a=(t,e)=>{const n=t.type;if("string"===n||"number"===n||"boolean"===n)return r(t)===e;if("null"===n)return!0;if("array"===n)return 0===e.length;if("object"===n)return 0===Object.keys(e).length;throw`invalid schema type: ${n}`};function o(t,e,n){const i=e.type;if("string"===i||"number"===i||"boolean"===i)return r(e,n);if("null"===i)return null;if("array"===i){if(void 0===(e=e).items)return[];s(e,n)||(n=[]);const r=e.items,a=[];for(const e of n)a.push(o(t,r,e));return a}if("object"===i){if(void 0===(e=e).properties)return{};s(e,n)||(n={});const r=e.properties,i=e.required??[],c={};for(const[e,s]of Object.entries(r)){const r=n[e];if("expand"!==t)if("shrink"!==t){if("inject"!==t)throw`invalid mode: ${t}`;{const n=void 0!==r,a=i.includes(e);if(n||a){const n=o(t,s,r);c[e]=n}}}else{const n=o(t,s,r);a(s,n)||(c[e]=n)}else{const n=o(t,s,r);c[e]=n}}return c}throw`invalid schema type: ${i}`}function i(t,e){e=e??new WeakMap;const n=typeof t;if("string"===n||"number"===n||"boolean"===n||"function"===n||null===t)return t;if("object"!==n)throw`invalid type: ${n}`;if(e.has(t))throw"circular reference";if(Array.isArray(t)){e.set(t,!0);const n=t.map((t=>i(t,e)));return e.delete(t),n}e.set(t,!0);const s={};for(const[n,r]of Object.entries(t))s[n]=i(r,e);return e.delete(t),s}function c(t){const e=typeof t;if("string"===e||"number"===e||"boolean"===e)return{type:e,default:t};if(null===t)return{type:"null"};if(Array.isArray(t))return{type:typeof t[0],default:t[0],enum:t};if("object"!==e)throw`invalid value type: ${e}`;const n=t,s=n.type;if("string"!==s&&"number"!==s&&"boolean"!==s&&"null"!==s){if("array"!==s){if("object"===s){const t=n.properties??{};for(const[e,n]of Object.entries(t)){const s=c(n);void 0!==s&&(t[e]=s)}return!0===n.required&&(n.required=Object.keys(t)),void(!1===n.required&&(n.required=[]))}throw`invalid schema type: ${s}`}{const t=c(n.items);void 0!==t&&(n.items=t)}}}const l={type:"array",items:""},u={fontSize:100,fontColor:"#ffffff",fontOpacity:100,fontEdgeEffect:["none","shadow","raised","depressed","outline","stroke"],fontEdgeColor:"#ffffff",fontEdgeSize:0,fontBold:!0,fontItalic:!0,backgroundColor:"#ffffff",backgroundOpacity:100,backgroundEdgeEffect:["none","shadow"],backgroundEdgeColor:"#ffffff",borderSize:0,borderColor:"#ffffff"},h={display1:["true","false"],display2:["true","false","preserve"],flexAlign:["center","left","right","evenly"]},d={flexAlign:h.flexAlign,...u},p={...u},g={display:h.display2,...u},f={display:h.display2,flexAlign:h.flexAlign,...u},m={display:h.display2,backgroundColor:u.backgroundColor,backgroundEdgeEffect:u.backgroundEdgeEffect,backgroundEdgeColor:u.backgroundEdgeColor,borderSize:u.borderSize,borderColor:u.borderColor},y={display:h.display1,match:"",...u},v={display:h.display1,match:l,...u},w=t=>({type:"object",properties:t,required:!1}),b=(t=>{const e=i(t);return c(e),e})({type:"object",properties:{general:{type:"object",properties:{rendering:{type:"object",properties:{bottomMargin:100,baseStyle:["stroke","background","classic","none"],mouseAction:["none","text"]},required:!0},dropdown:{type:"object",properties:{subtitleCount:[2,3,4,5,6,7,8],showOnlyLanguages:""},required:!0}},required:!0},language:{type:"object",properties:{translation:{type:"object",properties:{languageList:["popular","available"],translationEngine:["google","microsoft"],translationMode:["auto","enhance","normal"]},required:!0},chinese:{type:"object",properties:{pinyinScheme:["putonghua","guangzhouhua","jyutping"]},required:!0},japanese:{type:"object",properties:{furiganaCharacter:["kanji","kana"]},required:!0}},required:!0},style:{type:"object",properties:{genres:{type:"array",items:{type:"object",properties:{name:"",component:{type:"object",properties:{none:null,dialogue:w(d),contents:w(p),readings:w(g),grammars:w(f),dividers:w(m),pinyin:w(y),hiragana:w(y),katakana:w(y),romaji:w(y),loanword:w(y),pos:w(v),form:w(v),tag:w(v),base:w(y),sense:w(v),jlpt:w(v)},required:!1}},required:!0}},rulers:{type:"array",items:{type:"object",properties:{name:"",genres:l,tokens:{type:"object",properties:{text:"",hiragana:"",katakana:"",romaji:"",loanword:"",pos:l,form:l,tag:l,base:"",sense:l,jlpt:l},required:!1}},required:!0}},themes:{type:"array",items:{type:"object",properties:{name:"",genres:l,rulers:l,toolkit:"none"},required:!0}}},required:!0},plugin:{type:"object",properties:{items:{type:"array",items:{type:"object",properties:{name:"",type:["none","style","script","standard","simple"],code:"",urls:{type:"array",items:""}},required:!0}}},required:!0},file:{type:"object",properties:{items:{type:"array",items:{type:"object",properties:{name:"",lang:"",code:"",urls:{type:"array",items:""}},required:!0}}},required:!0},network:{type:"object",properties:{server:{type:"object",properties:{apiUrl:["https://api.dualsub.xyz/"],apiKey:""},required:!0}},required:!0}},required:!0}),S=t=>((t,e)=>o("inject",t,e))(b,t);var x=n(6978);const k=async()=>{const{setting:t}=await x.Z.storage.get(["setting"]);return S(t)},C=["af","am","ar","az","be","bg","bn","bs","ca","ceb","co","cs","cy","da","de","el","en","eo","es","et","eu","fa","fi","fr","fy","ga","gd","gl","gu","ha","haw","hi","hmn","hr","ht","hu","hy","id","ig","is","it","iw","ja","jw","ka","kk","km","kn","ko","ku","ky","la","lb","lo","lt","lv","mg","mi","mk","ml","mn","mr","ms","mt","my","ne","nl","no","ny","or","pa","pl","ps","pt","ro","ru","rw","sd","si","sk","sl","sm","sn","so","sq","sr","st","su","sv","sw","ta","te","tg","th","tk","tl","tr","tt","ug","uk","ur","uz","vi","xh","yi","yo","zu"].concat(["zh-hans","zh-hant"]).concat([]),j=["af","am","ar","az","bg","bs","ca","cs","cy","da","de","el","en","es","et","fa","fi","fr","ga","gu","hi","hr","ht","hu","hy","id","is","it","ja","kk","km","kn","ko","lo","lt","lv","mg","mi","ml","mr","ms","mt","ne","nl","pa","pl","ps","ro","ru","sk","sl","sm","sq","sv","sw","ta","te","th","tr","uk","ur","vi"].concat(["tl","iw","no"]).concat(["bn","ku","my","or","pt","zh-hans","zh-hant"]),M=["bg","cs","da","de","el","en","es","et","fi","fr","ga","hr","hu","is","it","ja","lt","lv","mt","nl","no","pl","pt","ro","ru","sk","sl","sv"].concat(["zh-hans","zh-hant"]).concat([]),I=["ar","cs","de","el","en","es","fr","hu","ja","ko","pl","pt","ru","th","tr","vi","zh-hans","zh-hant"],N=t=>{let e=[];"google"===t.engine&&(e=C),"microsoft"===t.engine&&(e=j),"deepl"===t.engine&&(e=M);let n=[];"available"===t.filter&&(n=Array.from(e)),"popular"===t.filter&&(n=I.filter((t=>e.includes(t))));for(let s of t.attach)s=s.toLowerCase().replace("_","-").trim(),s=s.split("-")[0],!n.includes(s)&&e.includes(s)&&n.push(s);return n.sort(),n},Z=t=>{if(""===(t=t.trim()))return null;let e;t=t.replace(/\[/g,'["').replace(/\]/g,'"]').replace(/,/g,'","').replace(/\]\[/g,"],[");try{e=JSON.parse(`[${t}]`)}catch(t){return null}const n=[];for(let t=0;t<3;t++){let s=e[t]??[];s=s.map((t=>t.trim())).filter((t=>""!==t)),0===s.length&&s.push("SKIP"),n.push(s)}const s=[];for(const t of e[3]??[]){const e=parseInt(t);if(isNaN(e)||String(e)!==t)return null;s.push(e)}return 0===s.length&&s.push(0),{files:n[0],translates:n[1],legends:n[2],limits:s}};class T{constructor(t){this.rules=t}static fromText(t){const e=(t=>{if(""===(t=t.trim()))return[];const e=[];for(const n of t.split("\n")){const t=Z(n);t&&e.push(t)}return e})(t);return new T(e)}static fromCount(t){const e=Array(t).fill({files:["SKIP"],translates:["SKIP"],legends:["SKIP"],limits:[0]});return new T(e)}get(t,e,n){const s=[];let r=0;for(let a=0;a<n;a++){const n=e[a]??{file:"",translate:"",legend:""};let o=null;for(;r<this.rules.length;){const e=this.rules[r];if(r+=1,o=this.matchSchema(t,e,n,a),o)break}o?s.push(o):s.push({file:"",translate:"",legend:""})}return s}matchSchema(t,e,n,s){if(!e.limits.includes(0)&&!e.limits.includes(s+1))return null;const r=this.hasValues(t.files,e.files,n.file,!0);if(null===r)return null;const a=this.hasValues(t.translates,e.translates,n.translate,!0);if(null===a)return null;const o=this.hasValues(t.legends,e.legends,n.legend,!1);return null===o?null:{file:r,translate:a,legend:o}}hasValues(t,e,n,s){let r=[n];if(s){const t=["zh-hans","zh-cn"],e=["zh-hant","zh-tw","zh-hk","zh-mo"];t.includes(n)&&(r.push(...t),r.push(...e)),e.includes(n)&&(r.push(...e),r.push(...t));const s=n.split(/\b/)[0];r.push(s)}r=Array.from(new Set(r));let a=[];for(const t of e)"SKIP"!==t?"LAST"!==t?"CLOSE"!==t?a.push(t):a.push(""):a.push(...r):(a.push(...r),a.push(""));a=Array.from(new Set(a));let o=[];for(const e of a)if(""!==e)if(s){const n=new RegExp(`^${e}\\b`);for(const e of t)n.test(e.value)&&o.push(e.value)}else o.push(e);else o.push(e);o=Array.from(new Set(o));for(const e of o)if(this.hasValue(t,e))return e;return null}hasValue=(t,e)=>""===e||void 0!==t.find((t=>t.value===e))}const $=t=>{for(const e of t)if(""!==e.file)return!1;return!0},O=(t,e)=>{const n=`${location.origin}/`;for(const s of t.plugin.items)if(s.urls.includes(n)&&s.type===e)return s.code;return""};class L{constructor(t,e){this.setting=t,this.mode=e,this.count=t.general.dropdown.subtitleCount,this.text=O(t,this.mode),this.macroLast=T.fromCount(this.count),this.macroUser=T.fromText(this.text)}updateSetting(t){this.setting=t,this.count=t.general.dropdown.subtitleCount,this.text=O(t,this.mode),this.macroLast=T.fromCount(this.count),this.macroUser=T.fromText(this.text)}get(t,e){const n=this.macroLast.get(t,e,this.count),s=this.macroUser.get(t,e,this.count);return $(n)&&!$(s)?s:n}}var E=n(62),W=n(2536),P=n(2055);const z="dualsub-simple",D=(t,e)=>{const n=t.general.dropdown.showOnlyLanguages.toLowerCase().split(",").map((t=>t.trim())).filter((t=>""!==t)).map((t=>new RegExp(`^${t}\\b`)));if(0===n.length)return[...e];const s=e.filter((t=>n.some((e=>t.value.match(e)))));return 0===s.length?[...e]:s},R=async t=>{let e="";t.length>0&&(e=await(0,W.x8)(t)),window.postMessage({name:"subtitle",args:e},location.origin)};class A{constructor(t){this.setting=t,this.autoSelect=new L(t,"simple"),this.manifests=new Map,this.stage=null}getStageManifest(){if(!this.stage)return null;return this.manifests.get(this.stage.movieId)||null}executeCallback(t){"youtube"===E.Z.website&&this.executeCallbackYouTube(t)}executeCallbackYouTube(t){const e=this.getStageManifest();if(!e)return void R([]);const n=((t,e)=>{const n={};for(const e of t)n[e.code]=e;return n})(e.items),s=[];for(const e of t)if(""!==e.file){const t=new URL(n[e.file].url);t.searchParams.set("tlang",e.translate),s.push(t.toString())}R(s)}getMenuItemsFile(){const t=this.getStageManifest();if(!t)return[];let e=[];for(const n of t.items)e.push({label:n.name,value:n.code,title:n.code});return e.sort(((t,e)=>t.value>e.value?1:-1)),e=D(this.setting,e),e}getMenuItemsTranslate(){const t=this.getStageManifest();if(!t)return[];let e=[];for(const n of t.translations??[])e.push({label:n.name,value:n.code,title:n.code});if("popular"===this.setting.language.translation.languageList){const t=N({engine:"google",filter:"popular",attach:[navigator.language]});e=e.filter((e=>t.includes(e.value)))}return e.sort(((t,e)=>t.value>e.value?1:-1)),e=D(this.setting,e),e}getMenuItemsLegend(){const t=this.setting.style.themes,e=[];for(const n of t)e.push({label:n.name,value:n.name,title:n.name});return e}getSchema=()=>({files:this.getMenuItemsFile(),translates:this.getMenuItemsTranslate(),legends:this.getMenuItemsLegend()});getDefaultValue(t){const e=P.n9.getJSON(z)??[];return this.autoSelect.get(t,e)}load(){const t=this.getSchema();return{schema:t,value:this.getDefaultValue(t)}}save(t){var e,n;e=P.n9.getJSON(z),n=t,JSON.stringify(e)!==JSON.stringify(n)&&(P.n9.setJSON(z,t),this.executeCallback(t))}update(){const t=this.getSchema(),e=this.getDefaultValue(t);this.executeCallback(e)}updateSetting(t){this.setting=t,this.autoSelect.updateSetting(t)}updateStage(t){this.stage=t,this.update()}appendManifest(t){this.manifests.set(t.movieId,t),this.update()}}var q=n(7242);class J{constructor(t){this.setting=t}updateSetting(t){this.setting=t}getManifestItems(){const t=`${location.origin}/`,e=this.setting.file.items,n=[];for(let s=0;s<e.length;s++){const r=e[s];if(!r.urls.includes(t))continue;const a=(0,q.oY)(r.lang),o=(0,P.T4)(r.code),i=`${a} [${r.name}]`,c=`${r.lang}.file${s+1}`,l=`custom://file?text=${o}`;n.push({name:i,code:c,url:l})}return n}}const U="dualsub-standard",X=(t,e)=>{const n=t.general.dropdown.showOnlyLanguages.toLowerCase().split(",").map((t=>t.trim())).filter((t=>""!==t)).map((t=>new RegExp(`^${t}\\b`)));if(0===n.length)return[...e];const s=e.filter((t=>n.some((e=>t.value.match(e)))));return 0===s.length?[...e]:s};class G{constructor(t,e){this.setting=t,this.callback=e,this.autoSelect=new L(t,"standard"),this.fileManager=new J(t),this.manifests=new Map,this.stage=null}getStageManifest(){if(!this.stage)return null;return this.manifests.get(this.stage.movieId)||null}executeCallback(t){const e=this.createIntents(t);this.callback(e)}createIntents(t){const e=this.getStageManifest();if(!e)return[];const n=((t,e)=>{const n={};for(const e of t)n[e.code]=e;return n})(e.items),s=[];for(const e of t)if(""!==e.file){const t=n[e.file].url;s.push({url:t,...e})}return s}getMenuItemsFile(){const t=this.getStageManifest();if(!t)return[];let e=[];for(const n of t.items)e.push({label:n.name,value:n.code,title:n.code});return e.sort(((t,e)=>t.value>e.value?1:-1)),e=X(this.setting,e),e}getMenuItemsTranslate(){const t=this.setting.language.translation,e=N({engine:t.translationEngine,filter:t.languageList,attach:[navigator.language]});let n=[];for(const t of e)n.push({label:(0,q.oY)(t),value:t,title:t});return n.sort(((t,e)=>t.value>e.value?1:-1)),n=X(this.setting,n),n}getMenuItemsLegend(){const t=this.setting.style.themes,e=[];for(const n of t)e.push({label:n.name,value:n.name,title:n.name});return e}getSchema=()=>({files:this.getMenuItemsFile(),translates:this.getMenuItemsTranslate(),legends:this.getMenuItemsLegend()});getDefaultValue(t){const e=P.n9.getJSON(U)??[];return this.autoSelect.get(t,e)}load(){const t=this.getSchema();return{schema:t,value:this.getDefaultValue(t)}}save(t){var e,n;e=P.n9.getJSON(U),n=t,JSON.stringify(e)!==JSON.stringify(n)&&(P.n9.setJSON(U,t),this.executeCallback(t))}update(){const t=this.getSchema(),e=this.getDefaultValue(t);this.executeCallback(e)}updateSetting(t){this.setting=t,this.autoSelect.updateSetting(t),this.fileManager.updateSetting(t)}updateStage(t){this.stage=t,this.update()}appendManifest(t){const e=t.movieId,n=Array.from(t.items);n.push(...this.fileManager.getManifestItems()),t={movieId:e,items:n},this.manifests.set(t.movieId,t),this.update()}}class F{constructor(t,e){this.setting=t,this.props=e,this.simple=new A(t),this.standard=new G(t,e.onChange)}loadSimple(){if("youtube"!==E.Z.website)throw"unsupported website";const t=this.simple.load();return{schema:{menus:t.schema},value:{menus:t.value}}}saveSimple(t){const e=t.value;this.simple.save(e.menus)}loadStandard(){const t=this.standard.load();return{schema:{menus:t.schema},value:{menus:t.value}}}saveStandard(t){const e=t.value;this.standard.save(e.menus)}updateSetting(t){this.setting=t,this.simple.updateSetting(t),this.standard.updateSetting(t)}updateStage(t){this.simple.updateStage(t),this.standard.updateStage(t)}appendManifest(t){this.simple.appendManifest(t),this.standard.appendManifest(t)}}class H{constructor(t){this.setting=t,this.execute()}updateSetting(t){this.setting=t}execute(){const t=`${location.origin}/`,e=this.setting.plugin.items;for(const n of e){if(!n.urls.includes(t))continue;const e=document.createElement(n.type);e.textContent=n.code,document.head.appendChild(e)}}}const _=async t=>{const{Fetcher:e,Injecter:n,Renderer:s,Watcher:r}=t,a=await k(),o=new H(a),i=new e(a),c=new s(a,{fetcher:i}),l=new F(a,{onChange:t=>{c.updateIntents(t)}}),u=new r(a,{onChange:t=>{l.updateStage(t),c.updateStage(t)}}),h=new n(a,{onChange:t=>{l.appendManifest(t)}}),d={loadSimple:async(t,e)=>l.loadSimple(),saveSimple:async(t,e)=>{l.saveSimple(e)},loadStandard:async(t,e)=>l.loadStandard(),saveStandard:async(t,e)=>{l.saveStandard(e)}};window.addEventListener("message",h.onMessage),chrome.storage.onChanged.addListener(((t,e)=>{t.setting&&(t=>{o.updateSetting(t),i.updateSetting(t),c.updateSetting(t),l.updateSetting(t),u.updateSetting(t),h.updateSetting(t)})(t.setting.newValue)})),chrome.runtime.onMessage.addListener(((t,e,n)=>(((t,e,n,s)=>{const r=t[e.name];if(r)r(n,e.args).then((t=>s({ok:!0,data:t})),(t=>s({ok:!1,data:String(t)})));else{const t=`invalid name: ${e.name}`;s({ok:!1,data:t})}})(d,t,e,n),!0)))}},2055:(t,e,n)=>{n.d(e,{n9:()=>s,T4:()=>r,fi:()=>a});const s={getJSON:t=>{const e=localStorage.getItem(t);if(null===e)return;let n;try{n=JSON.parse(e)}catch{n=void 0}return n},setJSON:(t,e)=>{e=JSON.stringify(e),localStorage.setItem(t,e)}},r=t=>{const e=new Blob([t],{type:"plain/text"});return window.URL.createObjectURL(e)},a=t=>{const e=new URL(t),n=e.pathname.split("/");n[n.length-1]="";const s=n.join("/");return`${e.origin}${s}`}},3843:(t,e,n)=>{n.d(e,{D:()=>s});const s=t=>{const e=[];for(const n of t.split("\n")){if(!n.startsWith("#EXT-X-MEDIA:TYPE=SUBTITLES"))continue;const t={};for(const e of n.matchAll(/([A-Z-]+)=(YES|NO)/g)){const n=e[1].toLowerCase(),s="YES"===e[2];t[n]=s}for(const e of n.matchAll(/([A-Z-]+)="(.+?)"/g)){const n=e[1].toLowerCase(),s=e[2];t[n]=s}e.push(t)}return e}},2536:(t,e,n)=>{n.d(e,{x8:()=>c,be:()=>o});var s=n(8444),r=n(5329),a=n(1031);const o=t=>{const e=new Map;for(const n of t.dialogues){const t=`${n.start}:${n.end}`;e.set(t,n)}const n=Array.from(e.values());return new s.QE(n)},i=async t=>{const e=new URL(t),n=e.searchParams.get("lang")??"",i=e.searchParams.get("tlang")??"",c=""!==i,l=c?i:n;let u=await(async t=>{const e=await(await fetch(t)).text();if(e.includes("tOffsetMs"))return(t=>{const e=(t=>{const e=JSON.parse(t),n=(0,r.lU)(e),s=[];let a=[];const o=()=>{a.length>0&&(s.push((0,r.Wr)(a)),a=[])};let i=0,c=0;for(const t of n){const{start:e,duration:n,content:s}=t,r=e+n;(e>c||2===i)&&(o(),i=0),a.push(t),c=r,"\n"===s&&(i+=1)}return o(),s})(t),n=[];for(const t of e)n.push(new s.iu(t.start,t.duration,t.content));return new s.QE(n)})(e);const n=(0,s.HE)(e);return o(n)})(t);return u=(0,s.TL)(u),u=(0,a.c)(u,{languageCode:l,afterTranslate:c}),u},c=async t=>{const e=await Promise.all(t.map(i)),n=(0,s.jG)(e);return(0,s.kt)(n)}},5471:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){let t=null;setInterval((()=>{const e=window.player?.tech_?.sourceHandler_?.playlists?.master?.playlists??null;if(e!==t){const n=Object.entries(e).filter((([t,e])=>t.includes("SUBTITLES")&&t===e.uri));(async t=>{const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(Object.fromEntries(n)),t=e}}),3e3)}.toString();var c=n(7242);const l=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=[];for(const n of Object.values(t)){const t=n.attributes.NAME.replace("subtitle_",""),s=(0,c.oY)(t),r=n.segments[0]?.resolvedUri;e.push({name:s,code:t,url:r})}return{movieId:"",items:e}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getHint(){return location.pathname.startsWith("/shows/")||location.pathname.startsWith("/watch/")?location.pathname:null}getCurtain(){return document.querySelector(".video-open")}};(0,s.Z)({Fetcher:a,Injecter:l,Renderer:h,Watcher:p})},6726:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){e=e.replace(/(<\/?)tt:/g,"$1");const n=(0,r.Hw)(e);return(t=>{const e=36e6;if(!(t.dialogues[0].start<e))for(const n of t.dialogues)n.start-=e})(n),n}};var i=n(4511);const c=function(){let t="";setInterval((async function(){const e=location.pathname.split("/").filter((t=>""!==t));if(e.length<2||"video"!==e[0]||e[e.length-1]===t)return;t=e[e.length-1];const n=`https://api.ardmediathek.de/page-gateway/mediacollection/${t}?devicetype=pc`;(t=>{if("video"!==t?._type)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(await(await fetch(n)).json())}),3e3)}.toString();var l=n(7242);const u=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=[],n=t._subtitleUrl;if(n){const t="de",s=(0,l.oY)(t);e.push({name:s,code:t,url:n})}return{movieId:"",items:e}})(t)}};var h=n(2909);const d=class extends h.Z{};var p=n(556);const g=class extends p.Z{getHint(){return location.pathname.includes("/video/")?location.pathname:null}getCurtain(){return document.querySelector(".ardplayer")}getPlayer(){return document.querySelector("video[data-uuid]")}};(0,s.Z)({Fetcher:o,Injecter:u,Renderer:d,Watcher:g})},5170:(t,e,n)=>{n.r(e);var s=n(5997),r=n(2055),a=n(9755);const o=class extends a.Z{async createSubtitleUrls(t){const e=t.url,n=await this.fetch(t,e),s=(0,r.fi)(e);return n.split("\n").map((t=>t.trim())).filter((t=>t.endsWith(".vtt"))).map((t=>`${s}${t}`))}};var i=n(4511);const c=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.data?.attributes?.streams)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString();var l=n(3843);const u=async t=>{const e=await(await fetch(t.url)).text(),n=(0,l.D)(e);if(0===n.length)return null;const s=n[0];return{name:t.versions[0].label.replace(/\(.+?\)/,""),code:s.language,url:`${(0,r.fi)(t.url)}${s.uri}`}},h=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=t.data.attributes.streams,n=[];for(const t of e){const e=await u(t);e&&n.push(e)}return{movieId:"",items:n}})(t)}};var d=n(2909);const p=class extends d.Z{};var g=n(556);const f=class extends g.Z{getHint(){return location.pathname.includes("/videos/")?location.pathname:null}getCurtain(){return document.querySelector(".avp")}};(0,s.Z)({Fetcher:o,Injecter:h,Renderer:p,Watcher:f})},8085:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){return(0,r.KA)(e)}};var i=n(4511);const c=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.data?.subtitle?.subtitles)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString(),l=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=t.data.subtitle.subtitles,n=[];for(const t of e){const e=t.lan_doc,s=t.lan,r=t.subtitle_url;n.push({name:e,code:s,url:r})}return{movieId:"",items:n}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getHint(){if(location.pathname.startsWith("/bangumi/"))return location.pathname;if(!location.pathname.startsWith("/video/"))return null;const t=new URL(location.href).searchParams.get("p");return null!==t?`${location.pathname}?p=${t}`:location.pathname}getCurtain(){return location.pathname.startsWith("/bangumi/")?document.querySelector(".bpx-player-container"):document.querySelector("#bilibiliPlayer")}};(0,s.Z)({Fetcher:o,Injecter:l,Renderer:h,Watcher:p})},1798:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.linked?.["onDemandVideos.v1"]?.[0]?.subtitlesVtt)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString();var c=n(540);const l=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.linked["onDemandVideos.v1"][0].subtitlesVtt,n=await(async(t,e=1e3)=>{let n=null;for(;null===n;)await(0,c._)(e),n=document.querySelector(t);return n})("#select-language"),s=[];for(const t of n.children){const n=t.text,r=t.value,a=e[r];a&&s.push({name:n,code:r,url:a})}return{movieId:"",items:s}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getHint(){return location.pathname.includes("/lecture/")?location.pathname:null}getCurtain(){return document.querySelector("div[data-vjs-player]")}};(0,s.Z)({Fetcher:a,Injecter:l,Renderer:h,Watcher:p})},6664:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(2055),o=n(9755);const i=class extends o.Z{async createSubtitleUrls(t){const e=t.url,n=await this.fetch(t,e),s=(0,a.fi)(e);return n.split("\n").map((t=>t.trim())).filter((t=>t.endsWith(".vtt"))).filter((t=>!t.includes("DUB_CARD"))).map((t=>`${s}${t}`))}async createSubtitle(t){const e=await this.createSubtitleUrls(t),n=[];for(const s of e){const e=await this.fetch(t,s),r=await this.parse(t,e);n.push(...r.dialogues)}const s=new r.QE(n);return e[0]?.includes("BUMPER")&&(t=>{const e=t.dialogues;for(const t of e)t.start+=3e3})(s),s}};var c=n(4511);const l=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.stream?.complete)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString();var u=n(3843);const h=class extends c.Z{getScript(){return l}async createManifest(t){return await(async t=>{const e=t.stream.complete[0].url,n=await(await fetch(e)).text(),s=(0,u.D)(n),r=(0,a.fi)(e),o=[];for(const t of s){if(t.forced)continue;const e=t.name,n=t.language,s=`${r}${t.uri}`;o.push({name:e,code:n,url:s})}return{movieId:"",items:o}})(t)}};var d=n(2909);const p=class extends d.Z{};var g=n(556);const f=class extends g.Z{getHint(){return location.pathname.includes("/video/")?location.pathname:null}getCurtain(){return document.querySelector("#app_body_content")}};(0,s.Z)({Fetcher:i,Injecter:h,Renderer:p,Watcher:f})},5810:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){e=e.replace(/:(\d\d)'/g,".$1'");const n=(0,r.Hw)(e);return((t,e)=>{const n=new URL(e),s=new URLSearchParams(n.hash.slice(1)).get("start")??"0",r=Math.round(1e3*parseFloat(s));if(0!==r)for(const e of t.dialogues)e.start+=r})(n,t.url),n}};var i=n(4511);const c=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async(t,e)=>{if(!t||!e.includes("videoId")||!e.includes("urn:video:main"))return;const n={name:"manifest",args:t};window.postMessage(n,location.origin)})(n,e),n}}.toString(),l=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{let e;try{e=(t=>{for(const e of t)for(const t of e.body.videos)if("urn:video:main"===t.type)return{id:e.id.split(":").pop(),tracks:t.textTracks??[],start:t.start??0};return null})(t)}catch{e=null}if(null===e)return null;const n=e.id,s=[];for(const t of e.tracks){const n=t.displayName,r=t.language,a=`${t.url}#start=${e.start}`;s.push({name:n,code:r,url:a})}return{movieId:n,items:s}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getMovieId(){return location.pathname.split(":").pop()??null}getCurtain(){return document.querySelector("video[src]")?.parentElement?.parentElement?.parentElement??null}};(0,s.Z)({Fetcher:o,Injecter:l,Renderer:h,Watcher:p})},2109:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.data?.playBackSets)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString();var c=n(7242),l=n(2055);const u=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=(t=>{for(const e of t.data.playBackSets)if(e.tagsCombination.includes("package:dash"))return e.playbackUrl;return null})(t);if(null===e)return null;const n=(0,l.fi)(e),s=await(await fetch(e)).text(),r=(new DOMParser).parseFromString(s,"application/xml").getElementsByTagName("AdaptationSet"),a=[];for(const t of r){if("text/vtt"!==t.getAttribute("mimeType"))continue;const e=t.getAttribute("lang"),s=t.getElementsByTagName("BaseURL")[0].textContent,r=(0,c.oY)(e),o=e,i=`${n}${s}`;a.push({name:r,code:o,url:i})}return{movieId:"",items:a}})(t)}};var h=n(2909);const d=class extends h.Z{};var p=n(556);const g=class extends p.Z{getCurtain(){return document.querySelector(".player-base")}};(0,s.Z)({Fetcher:a,Injecter:u,Renderer:d,Watcher:g})},7642:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=Response.prototype.json;Response.prototype.json=async function(){const e=this.url,n=await t.call(this);return(async t=>{if(!t?.url?.includes("/playlist"))return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})({url:e,data:n}),n}}.toString();var c=n(7242);const l=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.data.transcripts_urls.webvtt,n=[];for(const[t,s]of Object.entries(e)){const e=(0,c.oY)(t);n.push({name:e,code:t,url:s})}return{movieId:"",items:n}})(t)}};var u=n(2909);const h=class extends u.Z{overlayOnPointerDown=t=>{t.stopPropagation()}};var d=n(556);const p=class extends d.Z{getHint(){return location.pathname.includes("/watch/")?location.pathname:null}getCurtain(){return document.querySelector("#web-player-app")}};(0,s.Z)({Fetcher:a,Injecter:l,Renderer:h,Watcher:p})},9284:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){return(0,r.CD)(e)}};var i=n(4511);const c=function(){let t=null;setInterval((()=>{const e=window.playerObject?.package?.engine,n=e?.movieinfo?.current?.originalData??null;n!==t&&((async t=>{if(!t?.data?.program?.stl)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),t=n)}),3e3)}.toString(),l={1:"zh-hans",2:"zh-hant",3:"en",4:"ko",18:"th",21:"ms",23:"vi",24:"id",26:"es",28:"ar"},u=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=t.data.program.stl,n=[];for(const t of e){const e=t._name,s=l[t.lid];if(!s)continue;const r=`https://meta.video.iqiyi.com/${t.srt}`;n.push({name:e,code:s,url:r})}return{movieId:"",items:n}})(t)}};var h=n(2909);const d=class extends h.Z{};var p=n(556);const g=class extends p.Z{getHint(){return location.pathname.startsWith("/play/")?location.pathname:null}getCurtain(){return document.querySelector(".iqp-player")}};(0,s.Z)({Fetcher:o,Injecter:u,Renderer:d,Watcher:g})},2600:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){return(0,r.rS)(e)}};var i=n(4511);const c=function(){const t=window.XMLHttpRequest;window.XMLHttpRequest=class extends t{get responseText(){const t=this.responseURL,e=super.responseText;return(async t=>{if(!t.url.includes("/weapi/song/lyric"))return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})({url:t,text:e}),e}};const e=new Map;setInterval((()=>{const t=document.querySelector(".play .words");if(!t||0===t.children.length)return;const n=t.firstElementChild.href.split("=")[1];if(e.has(n))return;e.set(n,!0);const s=document.querySelector(".ctrl .icn-list");s.click(),s.click()}),3e3)}.toString();var l=n(2171),u=n(7242),h=n(2055);const d=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=JSON.parse(t.text),n=document.querySelector(".play .words").firstElementChild.href.split("=")[1],s=[];let r;if(r=e.lrc?.lyric,r){const t=(0,l.L)(r),e=(0,u.oY)(t),n=(0,h.T4)(r);s.push({name:e,code:t,url:n})}if(r=e.tlyric?.lyric,r){const t="zh",e=(0,u.oY)(t),n=(0,h.T4)(r);s.push({name:e,code:t,url:n})}return{movieId:n,items:s}})(t)}};var p=n(2909);const g=class extends p.Z{};var f=n(556);class m{constructor(t){this.target=t,this.callback=null,this.observer=null,this.currentText="00:00",this.currentTime=0}onUpdate=()=>{const t=this.target.textContent.split("/")[0].trim();t===this.currentText?this.currentTime+=.25:(this.currentText=t,this.currentTime=(0,r.Wm)(t)/1e3),this.callback&&this.callback()};addEventListener(t,e){if(null!==this.callback||null!==this.observer)throw"invalid status";this.callback=e,this.observer=new MutationObserver(this.onUpdate),this.observer.observe(this.target,{childList:!0})}removeEventListener(t,e){if(this.callback!==e||null===this.observer)throw"invalid status";this.observer.disconnect(),this.observer=null,this.callback=null}}let y=null;const v=class extends f.Z{getMovieId(){const t=document.querySelector(".play .words");return t&&0!==t.children.length?t.firstElementChild.href.split("=")[1]:null}getPlayer(){if(y)return y;const t=document.querySelector(".play .time");return t?(y=new m(t),y):null}};(0,s.Z)({Fetcher:o,Injecter:d,Renderer:g,Watcher:v})},2669:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=JSON.stringify;JSON.stringify=e=>((t=>{if(t?.url?.toLowerCase().includes("manifest"))for(const e of Object.values(t)){const t=e?.profiles?.indexOf("nflx-cmisc")??-1;if(-1!==t){e.profiles.splice(t+1,0,"webvtt-lssdh-ios8");break}}})(e),t(e));const e=JSON.parse;JSON.parse=t=>{const n=e(t);return(async t=>{if(!t?.result?.timedtexttracks)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString(),c=t=>{const e=t.cdnlist??[],n=t.ttDownloadables["webvtt-lssdh-ios8"].downloadUrls;for(const{id:t}of e)if(n[t])return n[t];return Object.values(n)[0]},l=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.result.timedtexttracks,n=String(t.result.movieId),s=[];for(const t of e){if(t.isForcedNarrative||t.isNoneTrack)continue;let e=t.languageDescription,n=t.language;"closedcaptions"===t.rawTrackType&&(e=`${e} [CC]`,n=`${n}.cc`);const r=c(t);s.push({name:e,code:n,url:r})}return{movieId:n,items:s}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getHint(){return location.pathname.includes("/watch/")?location.pathname:null}getMovieId(){return document.querySelector("[data-videoid]")?.getAttribute("data-videoid")??null}getCurtain(){return document.querySelector(".watch-video, .NFPlayer")}};(0,s.Z)({Fetcher:a,Injecter:l,Renderer:h,Watcher:p})},3036:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=window.XMLHttpRequest;window.XMLHttpRequest=class extends t{get responseText(){const t=this.responseURL,e=super.responseText;return(t=>{if(!t.url.includes("SMIL")||!t.text.includes("webVTTCaptionURL"))return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})({url:t,text:e}),e}}}.toString();var c=n(7242);const l=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.text.match(/name="webVTTCaptionURL" value="(.+?)"/)[1],n=[],s=(0,c.oY)("en");return n.push({name:s,code:"en",url:e}),{movieId:"",items:n}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getCurtain(){return document.querySelector("cbsplayer > div")}};(0,s.Z)({Fetcher:a,Injecter:l,Renderer:h,Watcher:p})},3799:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.asset?.endpoints?.[0]?.url)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString();var c=n(2055);const l=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.asset.endpoints[0].url,n=(0,c.fi)(e),s=await(await fetch(e)).text(),r=(new DOMParser).parseFromString(s,"application/xml").getElementsByTagName("AdaptationSet"),a=[];for(const t of r){if("text/vtt"!==t.getAttribute("mimeType"))continue;const e=t.getAttribute("Label"),s=t.getAttribute("lang"),r=t.getElementsByTagName("BaseURL")[0].textContent,o=e.charAt(0).toUpperCase()+e.slice(1),i=s,c=`${n}${r}`;a.push({name:o,code:i,url:c})}return{movieId:"",items:a}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getHint(){return location.pathname.includes("/playback/")?location.pathname:null}};(0,s.Z)({Fetcher:a,Injecter:l,Renderer:h,Watcher:p})},4425:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){const n=(0,r.Hw)(e);return(t=>{if(document.querySelector(".cascadesContainer")){const e=1e4;for(const n of t.dialogues)n.start+=e}})(n),n}};var i=n(4511);const c=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if((t=>{if(!t?.widevine2License||!t?.returnedTitleRendition)return;if(2!==Object.keys(t).length)return;const e=t.returnedTitleRendition.titleId;sessionStorage.setItem("titleId",e)})(t),!t?.subtitleUrls||!t?.returnedTitleRendition)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString(),l=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=t.returnedTitleRendition.titleId,n=t.subtitleUrls,s=e,r=[];for(const t of n){const e=t.displayName,n=t.languageCode,s=t.url;r.push({name:e,code:n,url:s})}return{movieId:s,items:r}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getMovieId(){return sessionStorage.getItem("titleId")}getCurtain(){return document.querySelector(".cascadesContainer, .webPlayerSDKContainer")}getPlayer(){return document.querySelector(".dv-player-fullscreen video[src]")}};(0,s.Z)({Fetcher:o,Injecter:l,Renderer:h,Watcher:p})},2867:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){let t=null;setInterval((async()=>{if(!location.pathname.startsWith("/talks/"))return;if(location.pathname===t)return;t=location.pathname;const e=`${location.pathname}/metadata.json`;(async t=>{if(!t?.talks?.[0]?.player_talks?.[0])return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(await(await fetch(e)).json())}),3e3)}.toString(),c=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.talks[0].player_talks[0];let n=await(async t=>{const e=t.resources.hls.metadata,n=await(await fetch(e)).json(),s=[];for(const t of n.subtitles??[]){const e=t.name,n=t.code,r=t.webvtt;s.push({name:e,code:n,url:r})}return s})(e);return 0===n.length&&(n=await(async t=>{const e=t.resources.hls.stream,n=new URL(e).search,s=[];for(const e of t.languages){const r=e.languageName,a=e.languageCode,o=`https://hls.ted.com/talks/${t.id}/subtitles/${a}/full.vtt${n}`;s.push({name:r,code:a,url:o})}return s})(e)),{movieId:"",items:n}})(t)}};var l=n(2909);const u=class extends l.Z{};var h=n(556);const d=class extends h.Z{getHint(){return location.pathname.includes("/talks/")?location.pathname:null}getCurtain(){return document.querySelector("#ted-player")}};(0,s.Z)({Fetcher:a,Injecter:c,Renderer:u,Watcher:d})},8727:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.asset?.captions)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString(),c=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.asset.captions,n=String(t.id),s=[];for(const t of e){const e=t.video_label,n=t.locale_id,r=t.url;s.push({name:e,code:n,url:r})}return{movieId:n,items:s}})(t)}};var l=n(2909);const u=class extends l.Z{};var h=n(556);const d=class extends h.Z{getHint(){return location.pathname.includes("/lecture/")?location.pathname:null}getMovieId(){return location.pathname.split("/").pop()}getCurtain(){return document.querySelector('div[data-purpose="curriculum-item-viewer-content"]')}};(0,s.Z)({Fetcher:a,Injecter:c,Renderer:u,Watcher:d})},5571:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=JSON.parse;JSON.parse=e=>{const n=t(e);return(async t=>{if(!t?.subtitles)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),n}}.toString(),c=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.subtitles,n=[];for(const t of e){const e=t.label.replace(/\(.+?%\)/,""),s=t.srclang,r=t.src;n.push({name:e,code:s,url:r})}return{movieId:"",items:n}})(t)}};var l=n(2909);const u=class extends l.Z{};var h=n(556);const d=class extends h.Z{getHint(){return location.pathname.includes("/videos/")?location.pathname:null}getCurtain(){return document.querySelector(".page-section .video-player")}};(0,s.Z)({Fetcher:a,Injecter:c,Renderer:u,Watcher:d})},9428:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){let t="";setInterval((async function(){const e=document.querySelector("div[data-config-url]");if(null===e||e.id===t)return;t=e.id;const n=e.dataset.configUrl;(async t=>{if(!t?.request)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(await(await fetch(n)).json())}),3e3)}.toString(),c=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=t.request.text_tracks??[],n=[];for(const t of e){const e=t.label,s=t.lang,r=t.url;n.push({name:e,code:s,url:r})}return{movieId:"",items:n}})(t)}};var l=n(2909);const u=class extends l.Z{};var h=n(556);const d=class extends h.Z{getHint(){return location.pathname.match("/[0-9]+")?location.pathname:null}getCurtain(){return document.querySelector(".player_area")}};(0,s.Z)({Fetcher:a,Injecter:c,Renderer:u,Watcher:d})},5298:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){return(0,r.CD)(e)}};var i=n(4511);const c=function(){let t=null;setInterval((()=>{const e=document.querySelector(".VODPlayer");if(null===e)return;let n=null;for(const[t,s]of Object.entries(e))if(t.startsWith("__reactInternalInstance$")){n=s;break}const s=n?.child?.memoizedProps?.playlist[0]??null;s!==t&&((async t=>{const e={name:"manifest",args:t};window.postMessage(e,location.origin)})({tracks:s.tracks}),t=s)}),3e3)}.toString();var l=n(7242);const u={Chinese:"zh-hant",English:"en",German:"de",Spanish:"es",French:"fr",Italian:"it",Japanese:"ja"},h=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=t.tracks??[],n=[];for(const t of e){const e=u[t.text];if(!e)continue;const s=(0,l.oY)(e),r=t.file;n.push({name:s,code:e,url:r})}return{movieId:"",items:n}})(t)}};var d=n(2909);const p=class extends d.Z{};var g=n(556);const f=class extends g.Z{getHint(){return location.pathname.startsWith("/encore/")?location.pathname:null}getCurtain(){return document.querySelector(".fullscreen")}};(0,s.Z)({Fetcher:o,Injecter:h,Renderer:p,Watcher:f})},9685:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(9755);const o=class extends a.Z{async parse(t,e){return(0,r.CD)(e)}};var i=n(4511);const c=function(){let t=null;setInterval((()=>{const e=window.Txplayer?.Hls?.instance,n=e?.config?.vinfo??null;n!==t&&((async t=>{if(!t?.sfl?.fi)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)})(n),t=n)}),3e3)}.toString(),l=class extends i.Z{getScript(){return c}async createManifest(t){return await(async t=>{const e=t.sfl.fi,n=[];for(const t of e){if("close"===t.lang)continue;const e=t.name,s=t.lang,r=t.url;n.push({name:e,code:s,url:r})}return{movieId:"",items:n}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getHint(){return location.pathname.startsWith("/play/")?location.pathname:null}getCurtain(){return document.querySelector(".txp_player")}};(0,s.Z)({Fetcher:o,Injecter:l,Renderer:h,Watcher:p})},6752:(t,e,n)=>{n.r(e);var s=n(5997),r=n(8444),a=n(5329);const o=t=>{const{duration:e,content:n}=t,s=e;return n.match(/[0-9]{2}/)?.8*s:n.length>8?.9*s:s},i=(t,e)=>{const n=t.slice(0,e+1),s=t.slice(e+1);if(0===n.length||0===s.length)throw"invalid index";return[n,s]};function c(t,e){if(t.length<2)return[t];if((0,a.g9)(t)<e.duration)return[t];const n=[];for(const s of(t=>{if(t.length<2)throw"invalid length";const e=[];for(let n=0;n<t.length-1;n++){const s=o(t[n]);e.push({index:n,weight:s})}e.sort(((t,e)=>e.weight-t.weight));for(const n of e){const[e,s]=i(t,n.index);if((0,a.g9)(e)>=1500&&(0,a.g9)(s)>=1500)return[e,s]}const n=(0,a.g9)(t)/2;let s=0;for(let e=0;e<t.length-1;e++)if(s+=t[e].duration,s>=n)return i(t,e);const r=Math.floor((t.length-1)/2);return i(t,r)})(t))n.push(...c(s,e));return n}const l=t=>c(t,{duration:5e3}),u=t=>c(t,{duration:1e4}),h=(t,e)=>{const n=[];for(let s=0;s<t.length;s++){const r=t[s];if(0===n.length){n.push(r);continue}const o=n[n.length-1];e(o,r)?n[n.length-1]=(0,a.Wr)([o,r]):n.push(r)}return n},d=(t,e,n)=>{let s=0;e&&(s=n?t.length+100:t.length);const r=(0,a.Wr)(t);return r.duration>s&&(r.duration-=s),r},p=t=>{const e=JSON.parse(t);let n=(0,a.lU)(e);n=(t=>h(t,((t,e)=>"\n"===t.content)))(n),n=(t=>{const e=/^[0-9\n ]+$/;return h(t,((t,n)=>e.test(t.content)&&e.test(n.content)))})(n),n=(t=>{const e=new Map;for(let n=0;n<t.length;n++){const s=t.slice(n,n+4);for(;s.length>=2;){const t=(0,a.Wr)(s).content.replace(/\n/g," ").trim(),n=e.get(t)??0;e.set(t,n+1),s.pop()}}return h(t,((t,n)=>{const s=`${t.content}${n.content}`.replace(/\n/g," ").trim();return(e.get(s)??0)>=3}))})(n);const s=(t=>{const e=[];for(const n of(t=>c(t,{duration:15e3}))(t)){const t=[];for(const e of u(n)){const n=[];for(const t of l(e))n.push(t);t.push(n)}e.push(t)}return e})(n),r=(t=>{const e=[];for(const n of t)for(const[t,s]of n.entries()){const r=t===n.length-1;for(const[t,n]of s.entries()){const a=t===s.length-1;e.push(d(n,a,r))}}return e})(s);return r};var g=n(2536),f=n(9755);const m=class extends f.Z{async parse(t,e){if(e.includes("tOffsetMs"))return(t=>{const e=p(t),n=[];for(const t of e)n.push(new r.iu(t.start,t.duration,t.content));return new r.QE(n)})(e);const n=(0,r.HE)(e);return(0,g.be)(n)}};var y=n(4511);const v=function(){const t=new class{constructor(){this.text=""}toggle(){const t=document.querySelector(".html5-video-player");void 0!==t.getOption("captions","track")?.languageCode&&t.setOption("captions","reload",{})}refresh(){const t="dualsub-simple";""===this.text?document.body.classList.remove(t):document.body.classList.add(t)}save(t){this.text=t,this.toggle(),this.refresh()}match(t){return t.includes("/api/timedtext")&&""!==this.text}};window.addEventListener("message",(function(e){if(e.source!==window)return;const{name:n,args:s}=e.data;"subtitle"===n&&t.save(s)}));const e=window.XMLHttpRequest;window.XMLHttpRequest=class extends e{get responseText(){return t.match(this.responseURL)?t.text:super.responseText}};const n=async t=>{if(t?.playerResponse?.videoDetails&&(t=t.playerResponse),!t?.videoDetails)return;const e={name:"manifest",args:t};window.postMessage(e,location.origin)},s=JSON.parse;JSON.parse=t=>{const e=s(t);return n(e),e},setTimeout((()=>{const t=window.ytInitialPlayerResponse;t&&n(t)}),1e3)}.toString(),w=t=>t.simpleText?t.simpleText:t.runs?t.runs[0].text:"undefined",b=class extends y.Z{getScript(){return v}async createManifest(t){return await(async t=>{const e=t.videoDetails,n=t.captions?.playerCaptionsTracklistRenderer,s=n?.captionTracks??[],r=n?.translationLanguages??[],a=e.videoId,o=[];for(const t of s){const e=w(t.name);let n=t.languageCode.toLowerCase();"asr"===t.kind&&(n=`${n}.asr`);const s=new URL(t.baseUrl,location.origin);s.searchParams.set("fmt","json3"),s.searchParams.set("tlang","");const r=s.toString();o.push({name:e,code:n,url:r})}(t=>{const e={};for(const n of t){const t=e[n.code]??0;0===t?e[n.code]=1:(e[n.code]=t+1,n.code=`${n.code}.var${t}`)}})(o);const i=[];for(const t of r){const e=w(t.languageName),n=t.languageCode.toLowerCase();i.push({name:e,code:n})}return{movieId:a,items:o,translations:i}})(t)}};var S=n(2909);const x=class extends S.Z{};var k=n(556);const C=class extends k.Z{getHint(){if(!location.pathname.startsWith("/watch"))return null;const t=new URL(location.href).searchParams.get("v");return null!==t?`${location.pathname}?v=${t}`:location.pathname}getMovieId(){return new URL(location.href).searchParams.get("v")}getCurtain(){return document.querySelector(".html5-video-player")}getPlayer(){return document.querySelector("video")}};(0,s.Z)({Fetcher:m,Injecter:b,Renderer:x,Watcher:C})},7295:(t,e,n)=>{n.r(e);var s=n(5997),r=n(9755);const a=class extends r.Z{};var o=n(4511);const i=function(){const t=new Map,e=window.XMLHttpRequest;window.XMLHttpRequest=class extends e{get responseText(){const e=this.responseURL,n=super.responseText;return(async e=>{if(!e.url.includes("/vod/ptmd/mediathek/"))return;if(t.has(e.url))return;t.set(e.url,!0);const n={name:"manifest",args:e};window.postMessage(n,location.origin)})({url:e,text:n}),n}}}.toString();var c=n(7242);const l=class extends o.Z{getScript(){return i}async createManifest(t){return await(async t=>{const e=JSON.parse(t.text).captions,n=[];for(const t of e)if("webvtt"===t.format&&"deu"===t.language){const e="de",s=(0,c.oY)(e),r=t.uri;n.push({name:s,code:e,url:r});break}return{movieId:"",items:n}})(t)}};var u=n(2909);const h=class extends u.Z{};var d=n(556);const p=class extends d.Z{getCurtain(){return document.querySelector(".b-zdfplayer")}};(0,s.Z)({Fetcher:a,Injecter:l,Renderer:h,Watcher:p})}},e={};function n(s){var r=e[s];if(void 0!==r)return r.exports;var a=e[s]={exports:{}};return t[s](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=(0,n(9366).o)(location.href);globalThis!==window&&(globalThis.fetch=globalThis.content.fetch),"youtube"===t&&Promise.resolve().then(n.bind(n,6752)),"netflix"===t&&Promise.resolve().then(n.bind(n,2669)),"primevideo"===t&&Promise.resolve().then(n.bind(n,4425)),"disneyplus"===t&&Promise.resolve().then(n.bind(n,6664)),"paramountplus"===t&&Promise.resolve().then(n.bind(n,3036)),"amcplus"===t&&Promise.resolve().then(n.bind(n,5471)),"peacocktv"===t&&Promise.resolve().then(n.bind(n,3799)),"hulu"===t&&Promise.resolve().then(n.bind(n,7642)),"hbomax"===t&&Promise.resolve().then(n.bind(n,5810)),"viki"===t&&Promise.resolve().then(n.bind(n,5571)),"hotstar"===t&&Promise.resolve().then(n.bind(n,2109)),"coursera"===t&&Promise.resolve().then(n.bind(n,1798)),"udemy"===t&&Promise.resolve().then(n.bind(n,8727)),"ted"===t&&Promise.resolve().then(n.bind(n,2867)),"ard"===t&&Promise.resolve().then(n.bind(n,6726)),"zdf"===t&&Promise.resolve().then(n.bind(n,7295)),"arte"===t&&Promise.resolve().then(n.bind(n,5170)),"vimeo"===t&&Promise.resolve().then(n.bind(n,9428)),"viutv"===t&&Promise.resolve().then(n.bind(n,5298)),"iqiyiint"===t&&Promise.resolve().then(n.bind(n,9284)),"wetv"===t&&Promise.resolve().then(n.bind(n,9685)),"bilibili"===t&&Promise.resolve().then(n.bind(n,8085)),"music163"===t&&Promise.resolve().then(n.bind(n,2600))})()})();