"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[983],{80567:(e,t,o)=>{o.d(t,{a:()=>i});var r=o(32935),a=o(19234);async function i(e,t){const o=(0,a.gq)(t);if("skip"===o)return{valid:!0};if("insufficient_data"===o)return{valid:!1};const i=await(0,r.rux)(e,{address:{line1:t.addressLine1,city:t.city,zip:t.zipCode,state:t.state,country:t.country}});return"failed"===i.type?{valid:!1}:i.data}},59431:(e,t,o)=>{o.d(t,{Z:()=>P});var r=o(98135),a=o.n(r),i=o(59713),n=o.n(i),s=(o(33948),o(67294),o(66832)),d=o(5366),l=o(62727),p=o(33929),c=o(47966),u=o(90850),m=o(7765),y=o(32935),g=o(52016);class h extends g.Z{getInitialState(){return{temporaryCouponCode:void 0,couponCodeInput:void 0,error:void 0}}}const v=h;var f=o(4122),b=o(46951),S=o(8848),C=o(97880),M=o(50906);const Z=(0,d.vU)({couponCodePlaceholder:{id:"couponEntryInput.placeholder",defaultMessage:"Coupon code"},couponCodeNotFoundError:{id:"couponEntryInput.error.noPromo",defaultMessage:"Invalid coupon code"}});class x extends s.Z{constructor(...e){super(...e),n()(this,"storeTypes",{couponCode:v})}didMount(){const e=(0,u.Zk)(this.environment.currentUser.id);e&&this.stores.couponCode.setState({...this.stores.couponCode.state,temporaryCouponCode:e})}renderComponent(){return a()("div",{style:this.getContainerStyle()},void 0,a()("div",{style:{display:"flex",flexDirection:"row"}},void 0,a()(l.Z,{textarea:!1,value:this.stores.couponCode.state.couponCodeInput,placeholder:p.Z.formatMessage(Z.couponCodePlaceholder),onSubmit:()=>this.checkCouponCode(),onChange:e=>{this.stores.couponCode.setState({...this.stores.couponCode.state,couponCodeInput:e.target.value})},style:{height:32,paddingLeft:10,marginRight:this.props.hideApply?0:10}}),a()(m.Z,{request:this.stores.couponCode.state.temporaryCouponCode||null,performRequest:async e=>{if(e)return this.applyCouponCode(e)},render:(e,t,o)=>{if(!this.props.hideApply)return a()(c.Z,{isLarge:!1,onClick:()=>this.checkCouponCode()},void 0,a()(f.Z,{loaded:o,spinnerSize:16,showSpinnerTimeout:500},void 0,a()(d._H,{id:"couponEntryInput.button.apply",defaultMessage:"Apply"})))}})),this.stores.couponCode.state.error&&a()(b.Z,{isMultiline:!1,style:{paddingTop:8,color:S.ZP.red}},void 0,this.stores.couponCode.state.error))}checkCouponCode(){const e=this.stores.couponCode.state.couponCodeInput;e&&(this.stores.couponCode.setState({...this.stores.couponCode.state,temporaryCouponCode:e}),this.stores.couponCode.setState({...this.stores.couponCode.state,couponCodeInput:""}))}async applyCouponCode(e){const t=await y.ZkE(this.environment,{code:e});if("success"===t.type){var o;if(t.data.promo)return null!==(o=t.data.promo.applies_to)&&void 0!==o&&o.length&&!t.data.promo.applies_to.includes(this.props.plan)?void this.showError(e):(this.stores.couponCode.setState({...this.stores.couponCode.state,error:void 0}),this.props.handlePromo(t.data.promo),M.p8V(this.environment,{code:e,valid:!0,id:t.data.promo.id}),t.data.promo);this.showError(e)}else if("failed"===t.type){const e=t.error.name;this.stores.couponCode.setState({...this.stores.couponCode.state,error:e})}else(0,C.t1)(t)}showError(e){this.stores.couponCode.setState({...this.stores.couponCode.state,error:p.Z.formatMessage(Z.couponCodeNotFoundError)}),M.p8V(this.environment,{code:e,valid:!1,id:void 0})}getContainerStyle(){return{display:"flex",flexDirection:"column",...this.props.style?this.props.style:void 0}}}const P=x},27386:(e,t,o)=>{o.d(t,{Z:()=>l});var r=o(98135),a=o.n(r),i=(o(67294),o(29368)),n=o(592),s=o(66832);class d extends s.Z{static renderDivider(){return a()(i.Z,{size:37})}renderComponent(){const{device:e}=this.environment,{children:t,controlRow:o}=this.props,r=()=>e.isMobile?18:60,i=()=>e.isMobile?18:36;return this.props.disableScroller?a()("div",{style:{paddingLeft:r(),paddingRight:r()}},void 0,a()("div",{style:{paddingTop:i(),paddingBottom:i()}},void 0,t),o&&a()("div",{style:{paddingTop:16,paddingBottom:16,boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor)}},void 0,o)):a()("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",backgroundColor:this.theme.contentBackground}},void 0,a()(n.ZP,{type:n.xm.All,style:{flexGrow:1,WebkitOverflowScrolling:"touch",transform:"translateZ(0)",paddingLeft:r(),paddingRight:r(),paddingTop:i(),paddingBottom:i()}},void 0,t),o&&a()("div",{style:{flexGrow:0,flexShrink:0,paddingLeft:r(),paddingRight:r(),paddingTop:16,paddingBottom:16,boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor)}},void 0,o))}}const l=d},93039:(e,t,o)=>{o.d(t,{J:()=>P});var r=o(67154),a=o.n(r),i=o(98135),n=o.n(i),s=(o(33948),o(67294)),d=o.n(s),l=o(64215),p=o(5366),c=o(58879),u=o(62727),m=o(95009),y=o(25584),g=o(83071),h=o(31942),v=o(59054),f=o(97880),b=o(32935),S=o(48762),C=o(15692),M=o(19234),Z=o(27242),x=o(80676);function P(e){const t=(0,l.y)((e=>({container:(0,x.s)(e),cityZipRow:{display:"flex"},verticalDivider:{display:"flex",borderLeft:"1px solid",borderLeftColor:e.groupedFormBorder},zipRow:{display:"flex",flex:2},stateRow:{display:"flex",flex:3}})),[]),o=(0,p.YB)();return n()("div",{},void 0,n()("div",{style:t.container},void 0,n()(w,{placeholder:o.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.fullName",defaultMessage:"Full name"}),address:e.address,updateAddressField:e.updateAddressField,addressKey:"name"}),e.shouldShowBusinessName&&n()(w,{placeholder:o.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.businessName",defaultMessage:"Business name (optional)"}),address:e.address,updateAddressField:e.updateAddressField,addressKey:"businessName"}),n()(T,{updateAddressField:e.updateAddressField}),e.address&&(0,M.Le)(e.address.country)&&d().createElement(d().Fragment,null,n()(w,{placeholder:o.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.address",defaultMessage:"Address"}),address:e.address,addressKey:"addressLine1",updateAddressField:e.updateAddressField}),n()(w,{placeholder:o.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.city",defaultMessage:"City"}),addressKey:"city",address:e.address,updateAddressField:e.updateAddressField}),n()("div",{style:t.cityZipRow},void 0,n()("div",{style:t.zipRow},void 0,n()(w,{placeholder:o.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.zipCode",defaultMessage:"Zip code"}),address:e.address,addressKey:"zipCode",updateAddressField:e.updateAddressField})),n()("div",{style:t.verticalDivider}),n()("div",{style:t.stateRow},void 0,n()(w,{placeholder:o.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.state",defaultMessage:"State / Province"}),address:e.address,addressKey:"state",updateAddressField:e.updateAddressField}))))))}function T(e){const t=(0,c.O7)(),[o,r]=(0,s.useState)(!1),i=(0,p.YB)(),M=(0,l.y)((()=>({input:{background:"none",boxShadow:"none",padding:8}})),[]),[P,T]=d().useState(""),[w]=(0,v.r5)((async()=>{const e=await b.o6k(t,{});return"success"===e.type?e.data.countries:"failed"===e.type?[]:void(0,f.t1)(e)}),[t]),A=w.value;if(!A)return null;const B=(0,h.ZP)(P,A,(e=>e.name)).map(((t,o)=>({key:o,render:e=>d().createElement(S.Z,a()({},e,{title:t.name})),action:()=>{e.updateAddressField("country",t.countryCode);const o=Z.Z.state;o.open&&Z.Z.setState({...o,vatApplicable:Boolean(t.vatApplicable)}),T(t.name),r(!1)}})));return n()(x.c,{},void 0,n()(C.ZP,{popupType:C.ZP.PopupType.Popup,alignmentToOrigin:C.ZP.Alignment.End,placementToOrigin:C.ZP.Placement.Right,originGap:0,open:o,origin:n()(u.Z,{value:P,focus:o,placeholder:i.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.country",defaultMessage:"Country or region"}),style:M.input,onChange:t=>{T(t.target.value),e.updateAddressField("country",void 0)},onFocus:()=>{r(!0)}}),onDismiss:()=>{r(!1),T("")},render:()=>n()(m.ZP,{menuType:m.ZP.MenuType.Popup,width:"100%"},void 0,n()(y.Z,{type:y.Z.Type.Vertical,initialFocus:P.length>0?0:void 0,sections:[{key:0,render:e=>d().createElement(g.Z,a()({},e,{title:n()(p._H,{id:"spaceSubscriptionBillingInfoForm.countryDropdown.title",defaultMessage:"Select a country or region"})})),items:B}]}))}))}function w(e){const t=(0,l.y)((()=>({input:{background:"none",boxShadow:"none",padding:8}})),[]);return n()(x.c,{},void 0,n()(u.Z,{value:e.address[e.addressKey],style:t.input,placeholder:e.placeholder,onChange:(o=e.updateAddressField,r=e.addressKey,e=>{o(r,e.target.value)})}));var o,r}},10644:(e,t,o)=>{o.d(t,{Z:()=>p});var r=o(98135),a=o.n(r),i=(o(67294),o(66832)),n=o(27386),s=o(46951),d=o(5366);class l extends i.Z{renderComponent(){return a()(n.Z,{},void 0,a()(s.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,a()(d._H,{id:"spaceSubscriptionPlans.offlineMessage",defaultMessage:"Please go online to manage your plan."})))}}const p=l},83516:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ze});var r=o(67154),a=o.n(r),i=o(98135),n=o.n(i),s=o(59713),d=o.n(s),l=(o(33948),o(67294)),p=o.n(l),c=o(66832),u=o(5366),m=o(592),y=o(1643),g=o(82990),h=o(83328),v=o(97880),f=o(86664),b=o(21325),S=o(88477),C=o(47307),M=o(90850),Z=o(92083),x=o(27242),P=o(8848),T=o(64215),w=o(89940),A=o(93039),B=o(62727),_=o(80676),k=o(96486),U=o(32935),F=o(19234),I=o(78291);async function H(e){const t=x.Z.state,o=I.Z.state.data;if(!t.open||!o)return;if(t.vatApplicable&&t.temporaryVatCode)return void x.Z.setState({...t,taxAmount:void 0,calculatingTax:!1});const r=t.temporaryAddress;if("insufficient_data"===(0,F.gq)(r))return;x.Z.setState({...t,calculatingTax:!0});const{planAmount:a,promoInfo:i,creditAmount:n,accountBalance:s}=(0,y.uN)({state:t,promo:t.appliedPromo,data:o}),d=await(0,U.kmL)(e,{address:r,price:Math.max(0,a-i.amount-n-s),vatId:t.vatApplicable?t.temporaryVatCode:void 0});if("failed"===d.type)x.Z.setState({...t,taxAmount:void 0,calculatingTax:!1});else{const e=d.data;e.valid?x.Z.setState({...t,taxAmount:e.taxAmount,calculatingTax:!1}):x.Z.setState({...t,taxAmount:void 0,calculatingTax:!1})}}var E=o(58879),z=o(74350);function R(e){const t=(0,T.y)((e=>({container:(0,_.s)(e),header:N(e),cityZipRow:{display:"flex"},verticalDivider:{display:"flex",borderLeft:"1px solid",borderLeftColor:e.groupedFormBorder},zipRow:{display:"flex",flex:2},stateRow:{display:"flex",flex:3}})),[]),o=(0,E.O7)(),[r]=(0,l.useState)((()=>(0,k.debounce)((async()=>{await H(o)}),3e3))),[a]=(0,w.oR)(x.Z);if(!a.open)return null;const i=a.temporaryAddress;return n()("div",{},void 0,n()("label",{style:t.header},void 0,n()(u._H,{id:"spaceSubscriptionPaymentForm.billingInformation.header",defaultMessage:"Billing information"})),n()(A.J,{address:i,updateAddressField:async(e,t)=>{x.Z.setAddressField(e,t),await r()},shouldShowBusinessName:["team","enterprise"].includes(e.storeState.subscriptionTier)}),n()(L,{storeState:e.storeState}),n()(O,{onUpdate:async()=>{await r()}}))}function L(e){const t=(0,T.y)((t=>({container:{...D(t),padding:"5px 5px 5px 10px"},header:{...N(t),paddingTop:20},wrapper:{..."credit_card"!==e.storeState.temporaryPaymentMethod?{display:"none"}:void 0}})),[e.storeState.temporaryPaymentMethod]),o=(0,T.F)(),[r]=(0,w.oR)(x.Z);return r.open?n()("div",{style:t.wrapper},void 0,n()("label",{style:t.header},void 0,n()(u._H,{id:"spaceSubscriptionPaymentForm.paymentInformation.header",defaultMessage:"Payment information"})),n()("div",{style:t.container},void 0,n()(f.CardElement,{options:{disabled:"disabled"===r.payButtonState,style:{base:{iconColor:o.blueColor,color:o.regularTextColor,fontFamily:g.Z.getCompositeFontFamily(z.SP).sans,fontSmoothing:"antialiased",fontSize:"14px","::placeholder":{color:o.lightTextColor},lineHeight:"2em"},complete:{iconColor:o.blueColor},invalid:{color:P.ZP.red,iconColor:P.ZP.red}},hidePostalCode:!0}}))):null}function O(e){const t=(0,T.y)((e=>({container:{...D(e),borderBottom:"none"},header:{...N(e),paddingTop:20},input:{background:"none",boxShadow:"none",padding:8},subtitle:{color:e.mediumTextColor,fontSize:g.Z.fontSize.UISmall.desktop,marginTop:5,marginBottom:10}})),[]),o=(0,u.YB)(),[r,a]=(0,w.oR)(x.Z);return r.open&&r.vatApplicable?n()("div",{},void 0,n()("label",{style:t.header},void 0,n()(u._H,{id:"spaceSubscriptionPaymentForm.vatCountryCode.header",defaultMessage:"VAT (optional)"})),n()("div",{style:t.container},void 0,n()(_.c,{},void 0,n()(B.Z,{value:r.temporaryVatCode,style:t.input,placeholder:o.formatMessage({id:"spaceSubscriptionPaymentForm.vatCountryCode.placeholder",defaultMessage:"VAT/GST number"}),onChange:t=>{a({...r,temporaryVatCode:t.target.value}),e.onUpdate(t.target.value)}}))),n()("div",{style:t.subtitle},void 0,n()(u._H,{id:"spaceSubscriptionBilling.vatCountryCode.subtitle",defaultMessage:"Please include your country code"}))):null}function D(e){return{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBorder,borderRadius:3}}function N(e){return{display:"flex",alignItems:"center",marginBottom:6,fontSize:12,fontWeight:g.Z.fontWeight.semibold,color:e.mediumTextColor}}var W=o(27832),V=o(66205),Y=o(45407),q=o(72693),K=o(46167),G=o(47966),j=o(48762),Q=o(95009),J=o(25584),$=o(83071),X=o(88632),ee=o(10644),te=o(32056),oe=o(59431),re=o(29368),ae=o(50906),ie=o(47714);function ne(e){const[t,o]=(0,w.oR)(x.Z),r=(0,T.y)(se,[]),a=(0,E.O7)(),i=(0,u.YB)();return!t.open||e.data.availableCredit<=0?null:n()("div",{style:r.toggle,onClick:()=>{!function(e){const{data:t,state:o,setModalState:r,environment:a}=e,i=void 0===o.temporaryUseCreditCents||o.temporaryUseCreditCents===t.availableCredit?0:t.availableCredit;r({...o,temporaryUseCreditCents:i}),ae.Jy$(a,{credits:i})}({environment:a,data:e.data,state:t,setModalState:o})}},void 0,n()("div",{style:{marginRight:8}},void 0,n()(u._H,{id:"applyCreditToggle.applyCredit.amount",defaultMessage:"Apply {creditAmount} credit",description:"Whether to apply credit to this subscription. The amount is formatted with currency",values:{creditAmount:(0,te.Dx)({amount:e.data.availableCredit,currency:"dollar",intl:i})}})),n()(ie.Z,{on:(0,y.Ry)(t,e.data)===e.data.availableCredit}))}function se(e){return{toggle:{cursor:"pointer",fontSize:14,color:e.regularTextColor,display:"flex",justifyContent:"space-between",marginTop:14,marginBottom:7}}}var de=o(68932);function le(e){const{state:t,data:o,promo:r}=e,a=(0,T.y)((e=>({container:{display:"flex",flexDirection:"column"},header:{fontSize:16,color:e.regularTextColor,fontWeight:g.Z.fontWeight.semibold,marginBottom:10}})),[]),i=S.HA[e.state.subscriptionTier][e.state.temporaryBillingInterval||"year"];return n()("div",{style:a.container},void 0,n()("label",{style:a.header},void 0,n()(u._H,{id:"spaceSubscriptionUpgradeModal.orderSummary.header",defaultMessage:"Order summary"})),n()(me,{state:t,data:o,promo:r}),n()(oe.Z,{style:{marginTop:10},plan:i,handlePromo:t=>x.Z.setState({...e.state,appliedPromo:t})}),0!==o.availableCredit&&p().createElement(p().Fragment,null,n()(ne,{data:o}),n()(re.Z,{size:14})),n()(ce,{style:{marginTop:0===o.availableCredit?14:0},state:t,data:o,promo:r}),n()(re.Z,{size:14}),n()(pe,{state:t,data:o,promo:r}))}function pe(e){const{state:t,data:o,promo:r}=e,{payAmount:a}=y.uN({state:t,promo:r,data:o});return n()(ue,{lineItem:{price:a,type:"standard",name:n()(u._H,{id:"spaceSubscriptionUpgradeOrderSummary.orderTotal",defaultMessage:"Total"})},priceStyle:{fontSize:20}})}function ce(e){const{state:t,data:o,promo:r,style:a}=e,{lineItems:i}=y.uN({state:t,promo:r,data:o}),s=i.map((e=>n()(ue,{lineItem:e},"".concat(e.name,":").concat(e.price,":").concat(e.type))));return n()("div",{style:a},void 0,s)}function ue(e){const{lineItem:t,priceStyle:o}=e,r=(0,T.y)((e=>({container:{marginTop:24},itemContainer:{display:"flex",justifyContent:"space-between",alignItems:"baseline",lineHeight:1.7},name:{fontSize:14,color:e.mediumTextColor},price:{fontSize:14,color:"promotion"===t.type?"#53A83F":e.regularTextColor,...o||void 0},caption:{fontSize:12,color:e.mediumTextColor},captionContainer:{display:"flex",flexDirection:"column"}})),[t,o]),a=(0,u.YB)(),i=t.price?(0,te.Dx)({amount:t.price,currency:"dollar",intl:a}):"—";return n()("div",{style:r.itemContainer},void 0,n()("div",{style:r.captionContainer},void 0,n()("span",{style:r.name},void 0,t.name),t.subtitle&&n()("span",{style:r.caption},void 0,t.subtitle)),"calculating"===t.type?n()(de.Z,{}):n()("span",{style:r.price},void 0,i))}function me(e){const{state:t,data:o,promo:r}=e,a=(0,u.YB)(),i=function(e,t){const{subscriptionTier:o}=e,r=y.su(t);switch(o){case"personal":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.orderSummary.personalPlan",defaultMessage:"Personal pro plan"});case"team":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.orderSummary.teamPlan",defaultMessage:"Team plan ({numberOfMembers, plural, one {# member} other {# members}})",values:{numberOfMembers:r}});case"enterprise":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.orderSummary.enterprisePlan",defaultMessage:"Enterprise plan ({numberOfMembers, plural, one {# member} other {# members}})",values:{numberOfMembers:r}});default:(0,v.t1)(o)}}(t,o),s=function(e,t){const{subscriptionTier:o}=e,r=y.GD(e),a=y._B({subscriptionTier:o,billingInterval:r,intl:t});switch(r){case"year":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedYearly",defaultMessage:"{price} / user / month · Billed yearly",values:{price:a}});case"month":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedMonthly",defaultMessage:"{price} / user / month · Billed monthly",values:{price:a}});default:(0,v.t1)(r)}}(t,a),{planAmount:d}=y.uN({state:t,promo:r,data:o}),l=(0,T.y)((e=>({container:{display:"flex",justifyContent:"space-between",marginBottom:6},item:{},title:{fontSize:14},subtitle:{color:e.mediumTextColor,fontSize:12},price:{fontSize:14}})),[]);return n()("div",{style:l.container},void 0,n()("div",{style:l.item},void 0,n()("div",{style:l.title},void 0,i),n()("div",{style:l.subtitle},void 0,s)),n()("div",{style:l.price},void 0,(0,te.Dx)({amount:d,currency:"dollar",intl:a})))}var ye=o(46951),ge=o(3779),he=o(16100),ve=o(64875),fe=o(80567),be=o(15102),Se=o(69972),Ce=o(85419);class Me extends c.Z{constructor(...e){super(...e),d()(this,"storeTypes",{paymentOptionAvailabilityStore:Y.Z}),d()(this,"renderModal",(()=>{const e=x.Z.state;if(e.open)return X.Z.state.online?n()("div",{style:this.getModalStyle()},void 0,n()("div",{style:{flex:1,maxWidth:"60%",backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.lightDividerColor),padding:"32px 32px 0px",display:"flex",flexDirection:"column",position:"relative"}},void 0,n()(m.ZP,{type:m.xm.Y,showScrollToBottomIndicator:!0},void 0,this.renderPlanHeader(e),this.renderBillingIntervalSection(e),this.renderPaymentMethodSection(e),n()(R,{storeState:e}))),n()("div",{style:{flex:1,maxWidth:"40%",backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.lightDividerColor),padding:"24px 20px 0px",display:"flex",flexDirection:"column",overflow:"scroll"}},void 0,n()(m.ZP,{type:m.xm.Y},void 0,n()(le,{state:e,data:this.props.data,promo:e.appliedPromo}),this.renderControls(e)))):n()(ee.Z,{})})),d()(this,"getBillingType",(e=>{const t=e.temporaryPaymentMethod;return"credit_card"===t||"native_payment_platform"===t?"charge_automatically":"invoice"===t?"send_invoice":void(0,v.t1)(t)})),d()(this,"validateAddress",(async e=>{const t=e.temporaryAddress,o=await(0,fe.a)(this.environment,t);return o.valid&&o.validatedAddresses&&x.Z.setState({...e,temporaryAddress:{...e.temporaryAddress,...o.validatedAddresses[0]}}),"CA"===t.country?{valid:!0}:(o.valid||(""===t.country?x.Z.setState({...e,error:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.missingCountryError",defaultMessage:"Please enter an address so we can process your payment."})}):x.Z.setState({...e,error:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})}),ae.VQs(this.environment,{error:void 0,error_type:"address"})),o)})),d()(this,"handleModalClose",(()=>{x.Z.reset()}))}didMount(){if(!x.Z.state.open)return;const{currentUserStore:e}=W.Z.state;if(e&&e.state.value){const t=(0,Ce.Nz)(this.props.intl,e.state.value);x.Z.setState({...x.Z.state,temporaryAddress:{...x.Z.state.temporaryAddress,name:t}})}y.BV(y.su(this.props.data))&&this.stores.paymentOptionAvailabilityStore.addPaymentOption("invoice")}didUpdate(e){if(this.props.stripe&&!e.stripe){const e=this.props.stripe.paymentRequest({country:"US",currency:"usd",total:{label:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.applePay.total.label",defaultMessage:"Notion - You will be charged on a recurring basis"}),amount:0}});e.canMakePayment().then((t=>{t&&(this.stores.paymentOptionAvailabilityStore.setState({...this.stores.paymentOptionAvailabilityStore.state,supportsApplePay:t.applePay,paymentRequest:e}),this.stores.paymentOptionAvailabilityStore.addPaymentOption("native_payment_platform"))})),e.on("token",(async e=>{const t=x.Z.state;if(!t.open)return;const{valid:o}=await this.validateAddress(t);o?this.handleUpgrade(e.token.id,e.complete):e.complete("fail")}))}}renderComponent(){return n()(be.Z,{open:x.Z.state.open,preventHideChildrenWhileOpening:!0,render:()=>n()(Se.Z,{capture:!0,allowEsc:!0,render:()=>this.renderModal()}),onDismiss:this.handleModalClose})}renderPlanHeader(e){return p().createElement(p().Fragment,null,ge.Z.notionLogoStroked({width:34,height:34,marginBottom:14}),n()("div",{style:{...this.getPrimaryTextStyle(),marginBottom:6}},void 0,this.getPlanTitle(e)),n()("div",{style:this.getSecondaryTextStyle()},void 0,this.getOneLiner(e)))}getOneLiner(e){switch(e.subscriptionTier){case"personal":return n()(u._H,{id:"subscriptionUpgradeModal.oneLiner.personal",defaultMessage:"For power users who want to do even more."});case"team":return n()(u._H,{id:"subscriptionUpgradeModal.oneLiner.team",defaultMessage:"Write, plan, and work together in one spot."});case"enterprise":return n()(u._H,{id:"subscriptionUpgradeModal.oneLiner.enterprise",defaultMessage:"Controls and support to run your company."})}}getPlanTitle(e){return{personal:n()(u._H,{id:"subscriptionUpgradeModal.title.personal",defaultMessage:"Upgrade to Personal Pro"}),team:n()(u._H,{id:"subscriptionUpgradeModal.title.team",defaultMessage:"Upgrade to Team"}),enterprise:n()(u._H,{id:"subscriptionUpgradeModal.title.enterprise",defaultMessage:"Upgrade to Enterprise"}),team_free:n()(u._H,{id:"subscriptionUpgradeModal.title.teamFree",defaultMessage:"Upgrade to Team Trial"})}[e.subscriptionTier]}renderControls(e){return p().createElement(p().Fragment,null,this.renderUpgradeButton(e),this.renderErrorMessage(e),this.renderContactSales(e))}renderContactSales(e){if("team"===e.subscriptionTier||"enterprise"===e.subscriptionTier)return p().createElement(p().Fragment,null,n()(G.Z,{style:{width:"100%",height:40,marginTop:10},onClick:()=>{const{currentUserStore:e}=W.Z.state,t=e&&e.getValue();V.Z.setState({open:!0,email:t&&t.email,name:t&&(0,Ce.Nz)(this.props.intl,t)})}},void 0,ge.Z.chat({height:18,width:20,marginRight:6}),n()("span",{style:{fontWeight:g.Z.fontWeight.medium}},void 0,n()(u._H,{id:"spaceSubscriptionSettings.upgradeModal.contactSales",defaultMessage:"Contact sales"}))),n()("p",{style:{color:this.theme.mediumTextColor,fontSize:12,lineHeight:g.Z.lineHeight.UISmall.desktop}},void 0,n()(u._H,{id:"spaceSubscriptionSettings.upgradeModal.sales.questions",defaultMessage:"Questions? Contact our sales team for more information."})))}renderErrorMessage(e){const t=e.error;if(t)return n()(ye.Z,{isMultiline:!0,style:{marginTop:8,color:P.ZP.red}},void 0,t)}renderUpgradeButton(e){const t=e.temporaryPaymentMethod,o={width:"100%",height:40,marginTop:24};return this.stores.paymentOptionAvailabilityStore.state.supportsApplePay&&"native_payment_platform"===t?n()("button",{style:{...o,WebkitAppearance:"-apple-pay-button"},onClick:()=>this.handleUpgradeClick(e)}):n()(q.Z,{disabled:"disabled"===e.payButtonState,style:o,onClick:()=>this.handleUpgradeClick(e)},void 0,this.getUpgradeButtonText(e))}getUpgradeButtonText(e){const{subscriptionTier:t}=e;switch(t){case"personal":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.upgradeButton.personalProPlan",defaultMessage:"Upgrade to Personal Pro"});case"team":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.upgradeButton.teamPlan",defaultMessage:"Upgrade to Team"});case"enterprise":return n()(u._H,{id:"spaceSubscriptionUpgradeModal.upgradeButton.enterprisePlan",defaultMessage:"Upgrade to Enterprise"});default:(0,v.t1)(t)}}renderBillingIntervalSection(e){const t=e.appliedPromo,{yearlyUnitPrice:o,monthlyUnitPrice:r}=y.uN({state:e,promo:t,data:this.props.data}),i=y.GD(e),s=1-o/(12*r),d=y.x7(e.subscriptionTier,s,this.props.intl),l=d.find((e=>e.id===i))||d[0],c=n()(u._H,{id:"spaceSubscriptionSettings.upgradeModal.billingIntervalSection.header",defaultMessage:"Billing interval"});return n()("div",{style:this.getSectionStyle()},void 0,n()("div",{style:this.getSubheaderStyle()},void 0,n()("div",{},void 0,c)),n()(K.Z,{popupType:K.Z.PopupType.Popup,placementToOrigin:K.Z.Placement.Bottom,sameWidthAsOrigin:!0,renderOrigin:e=>p().createElement(G.Z,a()({},e,{isLarge:!0,style:{marginBottom:4,width:"100%",justifyContent:"space-between"}}),l.title,ge.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),render:t=>{const o={menuType:Q.ZP.MenuType.Popup,width:"100%"},r=d.map((o=>({key:o.id,action:o=>{const r=d[o.index].id;x.Z.setState({...e,temporaryBillingInterval:r}),ae.FRI(this.environment,{billingInterval:r}),H(this.environment),t.close()},render:e=>p().createElement(j.Z,a()({},e,{title:o.title}))})));return p().createElement(Q.ZP,o,n()("div",{style:{width:"100%"}},void 0,n()(J.Z,{type:J.Z.Type.Vertical,sections:[{key:"billing interval section",render:e=>p().createElement($.Z,e),items:r}],initialFocus:void 0})))}}))}renderPaymentMethodSection(e){const t=e.temporaryPaymentMethod,o=n()(u._H,{id:"spaceSubscriptionSettings.upgradeModal.paymentMethodSection.header",defaultMessage:"Payment method"}),r=y.zt(this.stores.paymentOptionAvailabilityStore.state.availablePaymentMethods);return n()("div",{style:this.getSectionStyle()},void 0,n()("div",{style:this.getSubheaderStyle()},void 0,n()("div",{},void 0,o)),1===r.length?p().createElement(p().Fragment,null,n()("div",{style:{display:"flex",alignItems:"center",fontSize:14}},void 0,r[0].title),n()("div",{style:{color:this.theme.mediumTextColor,fontSize:12,marginLeft:24,marginTop:2,marginBottom:8}},void 0,r[0].caption)):r.map((({type:o,title:r,caption:a})=>n()(p().Fragment,{},o,this.renderRadioButton({title:r,caption:a,isSelected:t===o,onClick:()=>{const t={...e,temporaryPaymentMethod:o};x.Z.setState(t),ae.ieb(this.environment,{paymentMethod:o})},unavailable:!1})))))}renderRadioButton(e){const{title:t,caption:o,isSelected:r,onClick:a,unavailable:i}=e,s=i?.4:1;return n()("div",{style:{cursor:"pointer",opacity:s},onClick:a},void 0,n()("div",{style:{display:"flex",alignItems:"center",fontSize:14}},void 0,n()(h.Z,{isSelected:r}),t),n()("div",{style:{color:this.theme.mediumTextColor,fontSize:12,marginLeft:24,marginTop:2,marginBottom:8}},void 0,o))}async handleUpgradeClick(e){const t=e.temporaryPaymentMethod;ae.PNo(this.environment,{paymentMethod:t});const o=this.stores.paymentOptionAvailabilityStore.state.paymentRequest;if("native_payment_platform"===t&&o)return void o.show();x.Z.setState({...e,payButtonState:"disabled"});const{valid:r}=await this.validateAddress(e);r&&await this.handleNonNativeUpgrade(e);const a=x.Z.state;a.open&&x.Z.setState({...a,payButtonState:"enabled"})}async handleNonNativeUpgrade(e){if("invoice"===e.temporaryPaymentMethod)return await this.handleUpgrade(void 0,void 0);const{stripe:t,elements:o}=this.props;if(!o||!t)return void ve.cM({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const r=o.getElement(f.CardElement);if(!r)return void ve.cM({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe Card Element could not be found"}});const a=await t.createToken(r);if(!a.error&&a.token){const e=a.token.id;await this.handleUpgrade(e,void 0)}else a.error?(ae.VQs(this.environment,{error:a.error.message,error_type:"credit_card"}),x.Z.setState({...e,error:he.translateStripeError(this.props.intl,a.error)})):(ae.VQs(this.environment,{error:"could not create token",error_type:"credit_card"}),x.Z.setState({...e,error:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeModal.creditCard.genericError",defaultMessage:"Your card could not be processed. Please try again."})}))}async handleUpgrade(e,t){const o=x.Z.state;if(!o.open)return void(t&&t("fail"));const r=o.temporaryPaymentMethod;ae.fZH(this.environment,{paymentMethod:r});const{spaceStore:a,data:i}=this.props,n=y.GD(o),s=y.Ry(o,i),d=this.getBillingType(o),l=y.Md(o,i),p=S.HA[o.subscriptionTier][n],c=o.appliedPromo,u=o.temporaryAddress;await(0,b.Mg)({environment:this.environment,spaceStore:a,plan:p,stripeToken:e,billing:d,billingEmail:l,creditAmount:s,coupon:c&&"coupon"===c.source?c.code:void 0,customerName:u.name,businessName:u.businessName,addressLine1:u.addressLine1,addressCity:u.city,addressZip:u.zipCode,addressState:u.state,addressCountry:u.country,vatId:o.vatApplicable?o.temporaryVatCode:void 0,promoCodeId:c&&"promo_code"===c.source?c.code:void 0})?(t&&t("success"),"send_invoice"===d&&(0,C.UW)(this.props.intl.formatMessage({id:"spaceSubscriptionSettings.upgradeModal.checkEmailDialog.message",defaultMessage:"Please check your email for the invoice."})),c&&(0,M.$r)(this.environment.currentUser.id),this.handleModalClose(),Z.ZP.setState({...Z.ZP.state,currentTab:"billing"})):t&&t("fail")}getPrimaryTextStyle(){return{fontWeight:g.Z.fontWeight.bold,fontSize:22,lineHeight:1.1,marginBottom:2}}getSecondaryTextStyle(){return{fontWeight:g.Z.fontWeight.regular,fontSize:14,lineHeight:1.4,marginBottom:22,color:this.theme.mediumTextColor}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:3,width:650,maxHeight:760,height:"100vh",display:"flex"}}getSectionStyle(){return{marginBottom:20}}getSubheaderStyle(){return{display:"flex",alignItems:"center",marginBottom:6,fontSize:12,fontWeight:g.Z.fontWeight.semibold,color:this.theme.mediumTextColor}}}const Ze=(0,he.injectStripe)((0,u.XN)(Me))},80676:(e,t,o)=>{o.d(t,{s:()=>n,c:()=>s});var r=o(98135),a=o.n(r),i=(o(67294),o(64215));function n(e){return{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBorder,borderRadius:3,borderBottomWidth:0}}function s(e){const t=(0,i.y)((t=>({group:{display:"flex",borderBottomColor:t.groupedFormBorder,borderBottomWidth:1,borderBottomStyle:"solid",alignItems:"center",flex:1,...e.style}})),[e.style]);return a()("div",{style:t.group},void 0,e.children)}},16100:(e,t,o)=>{o.r(t),o.d(t,{injectStripe:()=>c,getStripe:()=>u,translateStripeError:()=>m});var r=o(98135),a=o.n(r),i=o(67294),n=o.n(i),s=o(86664),d=o(97894),l=o(95477);let p=null;function c(e){return t=>a()(s.Elements,{stripe:u()},void 0,a()(s.ElementsConsumer,{},void 0,(({stripe:o,elements:r})=>{const a={...t,stripe:o,elements:r};return n().createElement(e,a)})))}async function u(){return p||(d.loadStripe.setLoadParameters({advancedFraudSignals:!1}),p=(0,d.loadStripe)(l.Z.stripe.key)),p}function m(e,t){if(!t.code)return t.message||"";switch(t.code){case"invalid_expiry_year_past":return e.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return e.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."});default:return t.message||""}}},66205:(e,t,o)=>{o.d(t,{Z:()=>i});var r=o(52016);class a extends r.Z{getInitialState(){return{open:!1}}}const i=new a},45407:(e,t,o)=>{o.d(t,{Z:()=>s});o(33948);var r=o(52016),a=o(96486),i=o.n(a);class n extends r.Z{getInitialState(){return{availablePaymentMethods:["credit_card"],paymentRequest:void 0,supportsApplePay:!1}}isPaymentOptionAvailable(e){return this.state.availablePaymentMethods.includes(e)}addPaymentOption(e){const t=i().uniq([...this.state.availablePaymentMethods,e]);this.setState({...this.state,availablePaymentMethods:t})}}const s=n},19234:(e,t,o)=>{o.d(t,{gq:()=>r,Le:()=>a});o(96486);function r(e){return e.country&&!a(e.country)?"skip":e.addressLine1&&e.zipCode||e.addressLine1&&e.city&&e.state||e.zipCode?"should_resolve":"insufficient_data"}function a(e){return["US","CA"].includes(e)}}}]);